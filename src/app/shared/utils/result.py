# üßæ src/app/shared/utils/result.py
"""
üßæ result.py ‚Äî –ª–µ–≥–∫–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–∞—Ç–µ—Ä–Ω—É Result –¥–ª—è –∫–µ—Ä–æ–≤–∞–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫.

üîπ –ó–∞–±–µ–∑–ø–µ—á—É—î –¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É: `Ok` –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º —Ç–∞ `Err` –∑ –æ–ø–∏—Å–æ–º –ø–æ–º–∏–ª–∫–∏.
üîπ –ù–∞–¥–∞—î —É—Ç–∏–ª—ñ—Ç–∞—Ä–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞–Ω—É —Ç–∞ –º–∞–ø—ñ–Ω–≥—É —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è.
üîπ –î–æ–ø–æ–º–∞–≥–∞—î —É–Ω–∏–∫–∞—Ç–∏ –≤–∏–Ω—è—Ç–∫—ñ–≤ —É –ø–æ—Ç–æ–∫–∞—Ö –æ–±—Ä–æ–±–∫–∏ —Ç–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–æ–∑–æ—Ä–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å.
"""

from __future__ import annotations

# üåê –ó–æ–≤–Ω—ñ—à–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏
# (–∑–æ–≤–Ω—ñ—à–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ)

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
from dataclasses import dataclass										# üß± –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–º—É—Ç–∞–±–µ–ª—å–Ω–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤
from typing import Callable, Generic, TypeVar, Union					# üß∞ –ê–Ω–æ—Ç–∞—Ü—ñ—ó –¥–ª—è generics —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–π

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ –ø—Ä–æ—î–∫—Ç—É
# (–¥–ª—è —Ü—å–æ–≥–æ –º–æ–¥—É–ª—è –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —ñ–º–ø–æ—Ä—Ç–∏)

T = TypeVar("T")														# üî§ –¢–∏–ø —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è
E = TypeVar("E")														# ‚ö†Ô∏è –¢–∏–ø –ø–æ–º–∏–ª–∫–∏


# ================================
# üì¶ –ö–û–ù–¢–ï–ô–ù–ï–†–ò –†–ï–ó–£–õ–¨–¢–ê–¢–£
# ================================
@dataclass(frozen=True, slots=True)
class Ok(Generic[T]):
    """
    ‚úÖ –û–±–≥–æ—Ä—Ç–∫–∞ –¥–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.

    Attributes:
        value (T): –ë—ñ–∑–Ω–µ—Å-–∑–Ω–∞—á–µ–Ω–Ω—è, –æ—Ç—Ä–∏–º–∞–Ω–µ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó.
    """

    value: T															# üìä –ó–±–µ—Ä–µ–∂–µ–Ω–µ —É—Å–ø—ñ—à–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è


@dataclass(frozen=True, slots=True)
class Err(Generic[E]):
    """
    ‚ùå –û–±–≥–æ—Ä—Ç–∫–∞ –¥–ª—è –ø–æ–º–∏–ª–∫–æ–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.

    Attributes:
        error (E): –û–ø–∏—Å –∞–±–æ –æ–±'—î–∫—Ç, —è–∫–∏–π –ø–æ—è—Å–Ω—é—î –ø—Ä–∏—á–∏–Ω—É –Ω–µ–≤–¥–∞—á—ñ.
    """

    error: E															# ‚ö†Ô∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É


Result = Union[Ok[T], Err[E]]											# üîÅ –û–±'—î–¥–Ω–∞–Ω–∏–π —Ç–∏–ø Result –¥–ª—è –∑—Ä—É—á–Ω–æ—ó –∞–Ω–æ—Ç–∞—Ü—ñ—ó


# ================================
# üß™ –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á
# ================================
def is_ok(result: Result[T, E]) -> bool:
    """
    üß™ –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ —î —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å–ø—ñ—à–Ω–∏–º (`Ok`).

    Args:
        result (Result[T, E]): –ë—É–¥—å-—è–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

    Returns:
        bool: True, —è–∫—â–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —î `Ok`, False —ñ–Ω–∞–∫—à–µ.
    """
    return isinstance(result, Ok)										# ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î–º–æ —Ç–∏–ø —á–µ—Ä–µ–∑ isinstance


def is_err(result: Result[T, E]) -> bool:
    """
    üß™ –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ —î —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–º–∏–ª–∫–æ–≤–∏–º (`Err`).

    Args:
        result (Result[T, E]): –ë—É–¥—å-—è–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

    Returns:
        bool: True, —è–∫—â–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —î `Err`, False —ñ–Ω–∞–∫—à–µ.
    """
    return isinstance(result, Err)										# ‚ùå –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ –ø–æ–º–∏–ª–∫–æ—é


def map_ok(result: Result[T, E], transform: Callable[[T], T]) -> Result[T, E]:
    """
    üîÅ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î –∑–Ω–∞—á–µ–Ω–Ω—è `Ok`, –∑–∞–ª–∏—à–∞—é—á–∏ `Err` –±–µ–∑ –∑–º—ñ–Ω.

    Args:
        result (Result[T, E]): –í–∏—Ö—ñ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü—ñ—ó.
        transform (Callable[[T], T]): –§—É–Ω–∫—Ü—ñ—è –æ–±—Ä–æ–±–∫–∏ —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è.

    Returns:
        Result[T, E]: –ù–æ–≤–∏–π `Ok` —ñ–∑ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º –∞–±–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π `Err`.
    """
    if isinstance(result, Ok):
        mapped_value = transform(result.value)							# üßÆ –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—é –¥–æ –∑–Ω–∞—á–µ–Ω–Ω—è
        return Ok(mapped_value)											# ‚úÖ –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    return result														# ‚Ü©Ô∏è –î–ª—è `Err` –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–µ–∑ –∑–º—ñ–Ω


__all__ = ["Ok", "Err", "Result", "is_ok", "is_err", "map_ok"]			# üì¶ –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ –ø—É–±–ª—ñ—á–Ω–∏–π API –º–æ–¥—É–ª—è
