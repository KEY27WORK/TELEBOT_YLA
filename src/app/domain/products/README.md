# üì¶ Products Domain

–î–æ–º–µ–Ω **–ø—Ä–æ–¥—É–∫—Ç—ñ–≤**. –ú—ñ—Å—Ç–∏—Ç—å —á–∏—Å—Ç—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ, –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏ (—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏) —Ç–∞ –¥–æ–º–µ–Ω–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏.
–ù–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ ‚Äî —Ç—ñ–ª—å–∫–∏ –≤—ñ–¥ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ–π.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```bash
products/
‚îú‚îÄ‚îÄ services/
‚îÇ ‚îú‚îÄ‚îÄ README.md
‚îÇ ‚îú‚îÄ‚îÄ __init__.py
‚îÇ ‚îî‚îÄ‚îÄ weight_resolver.py
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ entities.py
‚îî‚îÄ‚îÄ interfaces.py
```

---

## üß± –°–∫–ª–∞–¥–æ–≤—ñ

### `entities.py`
- `ProductInfo` ‚Äî **–Ω–µ –∑–º—ñ–Ω–Ω–∞** (`frozen`) –¥–æ–º–µ–Ω–Ω–∞ —Å—É—Ç–Ω—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—É.
  - `price: Decimal`
  - `weight_g: int` (–≥—Ä–∞–º–∏ ‚Äî —Ç–æ—á–Ω—ñ—Å—Ç—å –±–µ–∑ –ø—Ä–æ–±–ª–µ–º float)
  - `stock_data` –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ `AvailabilityStatus`
- `Currency` ‚Äî –ø–µ—Ä–µ–ª—ñ–∫ –≤–∞–ª—é—Ç.

### `interfaces.py`
–ö–æ–Ω—Ç—Ä–∞–∫—Ç–∏ –¥–ª—è –¥–∂–µ—Ä–µ–ª –¥–∞–Ω–∏—Ö —ñ –ø–æ—à—É–∫—É:
- `IProductDataProvider`
- `ICollectionDataProvider`
- `IProductSearchProvider`

–ö–æ–Ω—Ç—Ä–∞–∫—Ç–∏ –≤–∞–≥–∏ (–¥–ª—è —Å–µ—Ä–≤—ñ—Å—É):
- `IWeightDataProvider` ‚Äî —Å—Ö–æ–≤–∏—â–µ –ª–æ–∫–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö –ø–æ –≤–∞–∑—ñ.
- `IWeightEstimator` ‚Äî AI‚Äë–æ—Ü—ñ–Ω–∫–∞ –≤–∞–≥–∏.

–î–æ–¥–∞—Ç–∫–æ–≤–æ:
- `Url` ‚Äî –∞–ª—ñ–∞—Å –¥–ª—è –∫–∞–Ω–æ–Ω—ñ—á–Ω–∏—Ö HTTPS‚ÄëURL.
- `SEARCH_DEFAULT_LIMIT`, `SEARCH_MAX_LIMIT` ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó/–æ–±–º–µ–∂–µ–Ω–Ω—è –¥–ª—è –ø–æ—à—É–∫—É.
- `SearchResult` ‚Äî DTO —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø–æ—à—É–∫—É (–∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é `score ‚àà [0, 1]`).

> **–í–∏–º–æ–≥–∏ –¥–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π**:
> - –£—Å—ñ URL ‚Äî **–∫–∞–Ω–æ–Ω—ñ—á–Ω—ñ HTTPS** (–ø—ñ—Å–ª—è `UrlParserService.normalize(...)`).
> - –ñ–æ–¥–Ω–æ—ó –º–µ—Ä–µ–∂–µ–≤–æ—ó —Ä–æ–±–æ—Ç–∏ –≤ `__init__`.
> - –ù–µ ¬´–∫–æ–≤—Ç–∞—Ç–∏¬ª `asyncio.CancelledError`.

### `services/weight_resolver.py`
`WeightResolver` ‚Äî –≤–∏–∑–Ω–∞—á–∞—î –≤–∞–≥—É:
1. –ü–æ—à—É–∫ —É `IWeightDataProvider`.
2. Fallback –¥–æ `IWeightEstimator`.
3. –û–Ω–æ–≤–ª—é—î –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ (–∫–µ—à).

–ü–æ–≤–µ—Ä—Ç–∞—î **`int` —É –≥—Ä–∞–º–∞—Ö**.

---

## üöÄ –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```python
from app.domain.products import (
    WeightResolver,
    IWeightDataProvider,
    IWeightEstimator,
)

resolver = WeightResolver(weight_data_provider, weight_estimator)
weight_g = await resolver.resolve_g(
    title="YoungLA 6022 Carpenter Jeans",
    description="–î–∂–∏–Ω—Å–∏ –∫–∞—Ä–≥–æ –∑ —Ç–æ–≤—Å—Ç–æ–≥–æ –¥–µ–Ω—ñ–º—É",
    image_url="https://..."
)
print("–í–∞–≥–∞ (–≥):", weight_g)
```

##  üß™ –¢–µ—Å—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å
–£ WeightResolver –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —è–∫ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ ‚Äî –ª–µ–≥–∫–æ –º–æ–∫–∞—Ç–∏.
ProductInfo –≤–∞–ª—ñ–¥—É—î –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –≤ __post_init__.

##  ‚úÖ –°—Ç–∏–ª—å/–≥–∞—Ä–∞–Ω—Ç—ñ—ó
–î–æ–º–µ–Ω–Ω–æ —á–∏—Å—Ç—ñ –º–æ–¥—É–ª—ñ (–±–µ–∑ —ñ–º–ø–æ—Ä—Ç—ñ–≤ —ñ–∑ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏).
–Ü–º–µ–Ω—É–≤–∞–Ω–Ω—è —É UPPER_SNAKE_CASE –¥–ª—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç.
–¢–∏–ø–∏ –∑ typing/dataclasses, –≥—Ä–æ—à—ñ ‚Äî Decimal, –≤–∞–≥–∞ ‚Äî int (g).