# üöª app/infrastructure/content/gender_classifier.py
"""
üöª –°–µ—Ä–≤—ñ—Å –∫–ª–∞—Å–∏—Ñ—ñ–∫—É—î —Ç–æ–≤–∞—Ä –∑–∞ –≥–µ–Ω–¥–µ—Ä–æ–º, –ø–æ–≤–µ—Ä—Ç–∞—é—á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ —Ö–µ—à—Ç–µ–≥–∏.

üîπ –ü—Ä–∞—Ü—é—î –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–∞–º–∏ –∞—Ä—Ç–∏–∫—É–ª–∞, —è–∫—ñ –∑–∞–¥–∞—é—Ç—å—Å—è –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó.  
üîπ –ü—ñ–¥—Ç—Ä–∏–º—É—î fallback ¬´default¬ª –¥–ª—è –≤–∏–ø–∞–¥–∫—ñ–≤, –∫–æ–ª–∏ –ø—Ä–µ—Ñ—ñ–∫—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.  
üîπ –õ–æ–≥—É—î –∫–æ–∂–µ–Ω –∫—Ä–æ–∫, —â–æ–±–∏ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏, —è–∫—ñ –ø—Ä–∞–≤–∏–ª–∞ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∏.
"""

from __future__ import annotations

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
import logging                                                      # üßæ –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤–∏–±–æ—Ä—É –ø—Ä–∞–≤–∏–ª
from typing import Dict, List                                       # üìê –¢–∏–ø–∏ –¥–ª—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ API

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ –ø—Ä–æ—î–∫—Ç—É
from app.shared.utils.logger import LOG_NAME                        # üè∑Ô∏è –Ü–º º—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ª–æ–≥–µ—Ä–∞

logger = logging.getLogger(LOG_NAME)                                # üßæ –ú–æ–¥—É–ª—å–Ω–∏–π –ª–æ–≥–µ—Ä


# ================================
# üöª –ö–õ–ê–°–ò–§–Ü–ö–ê–¢–û–† –ì–ï–ù–î–ï–†–Ü–í
# ================================
class GenderClassifier:
    """üöª –ü–æ–≤–µ—Ä—Ç–∞—î –≥–µ–Ω–¥–µ—Ä–Ω—ñ —Ö–µ—à—Ç–µ–≥–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø—Ä–µ—Ñ—ñ–∫—Å–∞ –∞—Ä—Ç–∏–∫—É–ª–∞."""

    def __init__(self, gender_rules: Dict[str, List[str]]) -> None:
        """–ó–∞–ø–∞–º º—è—Ç–æ–≤—É—î —Å–ª–æ–≤–Ω–∏–∫ –ø—Ä–µ—Ñ—ñ–∫—Å—ñ–≤ ‚Üí —Å–ø–∏—Å–æ–∫ —Ö–µ—à—Ç–µ–≥—ñ–≤."""
        self.gender_rules = gender_rules                            # üìö –ü—Ä–∞–≤–∏–ª–∞ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
        logger.debug("üß© GenderClassifier —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ: %s", gender_rules)

    def classify(self, article: str) -> List[str]:
        """–ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ —Ö–µ—à—Ç–µ–≥—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–¥–∞–Ω–æ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–∞."""
        if not article:
            logger.warning("‚ö†Ô∏è –ü–µ—Ä–µ–¥–∞–Ω–æ –ø–æ—Ä–æ–∂–Ω—ñ–π –∞—Ä—Ç–∏–∫—É–ª ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—é default.")
            return self.gender_rules.get("default", [])

        for prefix, tags in self.gender_rules.items():
            if prefix == "default":
                continue                                           # ‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ fallback
            if article.startswith(prefix):
                logger.info("üöª –ü—Ä–µ—Ñ—ñ–∫—Å '%s' –∑–±—ñ–≥–∞—î—Ç—å—Å—è. –¢–µ–≥–∏: %s", prefix, tags)
                return tags                                         # ‚úÖ –ó–Ω–∞–π—à–ª–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –Ω–∞–±—ñ—Ä

        fallback_tags = self.gender_rules.get("default", [])
        logger.info("üë§ Fallback: –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ default-—Ç–µ–≥–∏: %s", fallback_tags)
        return fallback_tags


__all__ = ["GenderClassifier"]
