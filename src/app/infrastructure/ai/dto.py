# üì¨ app/infrastructure/ai/dto.py
"""
üì¨ DTO-—Ä—ñ–≤–µ–Ω—å –¥–ª—è AI-–ø—Ä–æ–º–ø—Ç—ñ–≤, –Ω–µ–∑–∞–ª–µ–∂–Ω–∏–π –≤—ñ–¥ SDK OpenAI.

üîπ –û–ø–∏—Å—É—î —Ä–æ–ª—ñ —á–∞—Ç-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (`Role`) —Ç–∞ —ó—Ö–Ω—ñ–π –≤–º—ñ—Å—Ç (`ChatMessage`).
üîπ –ü–∞–∫—É—î —Å–ø–∏—Å–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å + –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ —É `ChatPrompt`.
üîπ –õ–æ–≥—É—î —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–∏, —â–æ–± –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –¥–∂–µ—Ä–µ–ª–∞ –∑–∞–ø–∏—Ç—ñ–≤.
"""

from __future__ import annotations

# üåê –ó–æ–≤–Ω—ñ—à–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏
# (–Ω–µ–º–∞—î)																# üö´ DTO –∞–≥—Ä–µ–≥—É—î —Ç—ñ–ª—å–∫–∏ stdlib

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
import logging															# üßæ –õ–æ–≥–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è DTO
from dataclasses import dataclass										# üß± –û–≥–æ–ª–æ—à–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä
from enum import Enum													# üßÆ –†–æ–ª—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
from typing import List, Optional										# üìê –¢–∏–ø–æ–≤—ñ –∞–Ω–æ—Ç–∞—Ü—ñ—ó

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ –ø—Ä–æ—î–∫—Ç—É
from app.shared.utils.logger import LOG_NAME							# üè∑Ô∏è –Ñ–¥–∏–Ω–µ —ñ–º º—è –ª–æ–≥–µ—Ä–∞


# ================================
# üßæ –õ–û–ì–ï–†
# ================================
logger = logging.getLogger(f"{LOG_NAME}.ai.dto")						# üßæ –Ü–º–µ–Ω–æ–≤–∞–Ω–∏–π –ª–æ–≥–µ—Ä DTO-—à–∞—Ä—É


# ================================
# üé≠ –†–û–õ–Ü –ü–û–í–Ü–î–û–ú–õ–ï–ù–¨
# ================================
class Role(str, Enum):
    """üé≠ –†–æ–ª—ñ –¥–ª—è —á–∞—Ç-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (system/user/assistant)."""

    SYSTEM = "system"													# üõ†Ô∏è –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
    USER = "user"														# üë§ –í—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    ASSISTANT = "assistant"												# ü§ñ –í—ñ–¥–ø–æ–≤—ñ–¥—å –º–æ–¥–µ–ª—ñ


# ================================
# üí¨ –û–ö–†–ï–ú–ï –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø
# ================================
@dataclass(frozen=True)
class ChatMessage:
    """üí¨ –ï–ª–µ–º–µ–Ω—Ç —á–∞—Ç-–¥—ñ–∞–ª–æ–≥—É —ñ–∑ –∑–∞–∑–Ω–∞—á–µ–Ω–Ω—è–º —Ä–æ–ª—ñ —Ç–∞ —Ç–µ–∫—Å—Ç—É."""

    role: Role															# üé≠ –†–æ–ª—å –∞–≤—Ç–æ—Ä–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    content: str														# üìù –¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

    def __post_init__(self) -> None:
        """–õ–æ–≥—É—î —Ñ–∞–∫—Ç —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–¥–æ–ø–æ–º–∞–≥–∞—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –≤—ñ–¥–ª–∞–¥–∫—É)."""
        logger.debug(
            "üí¨ ChatMessage created",
            extra={"role": self.role.value, "content_len": len(self.content)},
        )																# ü™µ –Ü–Ω—Ñ–æ –ø—Ä–æ –Ω–æ–≤–Ω–∏–π Message


# ================================
# üì¶ –ù–ê–ë–Ü–† –ü–û–í–Ü–î–û–ú–õ–ï–ù–¨ (–ü–†–û–ú–ü–¢)
# ================================
@dataclass(frozen=True)
class ChatPrompt:
    """
    üì¶ –ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π –Ω–∞–±—ñ—Ä –¥–ª—è –∑–∞–ø–∏—Ç—É –º–æ–¥–µ–ª—ñ.

    –ó–∞–∑–≤–∏—á–∞–π –º—ñ—Å—Ç–∏—Ç—å SYSTEM (–æ–ø—Ü—ñ–π–Ω–æ) —Ç–∞ USER-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
    """

    messages: List[ChatMessage]										# üí¨ –ü–æ—Ä—è–¥–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –¥–ª—è –º–æ–¥–µ–ª—ñ
    temperature: float = 0.3											# üå°Ô∏è –¢–≤–æ—Ä—á—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
    max_tokens: int = 1024												# üî¢ –õ—ñ–º—ñ—Ç –¥–æ–≤–∂–∏–Ω–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
    model: Optional[str] = None											# ü§ñ –Ø–∫—É –º–æ–¥–µ–ª—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ (None ‚Üí –∫–æ–Ω—Ñ—ñ–≥)

    def __post_init__(self) -> None:
        """–ü–∏—à–µ –¥–æ –ª–æ–≥—ñ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞."""
        logger.debug(
            "üì¶ ChatPrompt created",
            extra={
                "messages": len(self.messages),
                "temperature": self.temperature,
                "max_tokens": self.max_tokens,
                "model": self.model or "cfg-default",
            },
        )																# ü™µ –î–æ–ø–æ–º—ñ–∂–Ω–∏–π –ª–æ–≥


__all__ = ["Role", "ChatMessage", "ChatPrompt"]						# üì¶ –ü—É–±–ª—ñ—á–Ω–∏–π API –º–æ–¥—É–ª—è
