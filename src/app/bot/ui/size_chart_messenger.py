# üì¨ app/bot/ui/size_chart_messenger.py
"""
üì¨ size_chart_messenger.py ‚Äî –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ —Ä–æ–∑–º—ñ—Ä—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É —É —á–∞—Ç.
"""

# üåê –ó–æ–≤–Ω—ñ—à–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏
from telegram import Update											                        # üí¨ Telegram-–æ–± º—î–∫—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
import logging													                            # üßæ –õ–æ–≥—É–≤–∞–Ω–Ω—è
from typing import List											                            # üß∞ –°–ø–∏—Å–æ–∫ —Ä—è–¥–∫—ñ–≤ (—à–ª—è—Ö—ñ–≤ –¥–æ –∑–æ–±—Ä–∞–∂–µ–Ω—å)

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ –ø—Ä–æ—î–∫—Ç—É
from app.shared.utils.logger import LOG_NAME							                    # ü™µ –Ü–º º—è –ª–æ–≥–≥–µ—Ä–∞ –ø—Ä–æ—î–∫—Ç—É


# ================================
# üì§ –ö–õ–ê–° –î–õ–Ø –í–Ü–î–ü–†–ê–í–ö–ò –¢–ê–ë–õ–ò–¶–¨
# ================================
logger = logging.getLogger(LOG_NAME)  									                    # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ª–æ–≥–≥–µ—Ä–∞ –∑ —î–¥–∏–Ω–∏–º —ñ–º º—è–º

class SizeChartMessenger:
    """
    üì§ –ù–∞–¥—Å–∏–ª–∞—î –≤—Å—ñ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å —Ä–æ–∑–º—ñ—Ä—ñ–≤.
    """

    async def send(self, update: Update, image_paths: List[str]):
        """
        üì¶ –ú–µ—Ç–æ–¥ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –∫–æ–∂–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É —É —á–∞—Ç.

        Args:
            update (Update): üì¨ –û–± º—î–∫—Ç –æ–Ω–æ–≤–ª–µ–Ω–Ω—è Telegram.
            image_paths (List[str]): üñºÔ∏è –®–ª—è—Ö–∏ –¥–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö PNG —Ç–∞–±–ª–∏—Ü—å.
        """
        if not update.message:										                            # üö´ –Ø–∫—â–æ –Ω–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚Äî –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏–º–æ
            return

        if not image_paths:											                            # ‚ö†Ô∏è –Ø–∫—â–æ —Ç–∞–±–ª–∏—Ü—å –Ω–µ–º–∞—î ‚Äî –≤–∏–≤–æ–¥–∏–º–æ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
            await update.message.reply_text("‚ö†Ô∏è –¢–∞–±–ª–∏—Ü—ñ —Ä–æ–∑–º—ñ—Ä—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.")
            return

        for i, path in enumerate(image_paths, 1):							                    # üîÅ –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∫–æ–∂–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ–∫—Ä–µ–º–æ
            try:
                with open(path, "rb") as img_file:						                         # üìÇ –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ –±–∞–π—Ç–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ
                    caption = f"üìè –¢–∞–±–ª–∏—Ü—è —Ä–æ–∑–º—ñ—Ä—ñ–≤ ({i}/{len(image_paths)})"	                 # üè∑Ô∏è –ü—ñ–¥–ø–∏—Å –¥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                    await update.message.reply_photo(photo=img_file, caption=caption)	         # üì§ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ —É —á–∞—Ç
                logger.info(f"‚úÖ –ù–∞–¥—ñ—Å–ª–∞–Ω–æ —Ç–∞–±–ª–∏—Ü—é —Ä–æ–∑–º—ñ—Ä—ñ–≤: {path}")		                    # üßæ –õ–æ–≥ —É—Å–ø—ñ—à–Ω–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
            except Exception as e:
                logger.error(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ —Ç–∞–±–ª–∏—Ü—ñ {path}: {e}")	                # ‚ùó –õ–æ–≥ –ø–æ–º–∏–ª–∫–∏
                await update.message.reply_text(f"‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ —Ç–∞–±–ª–∏—Ü—ñ ‚Ññ{i}")	      # ‚ö†Ô∏è –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ —á–∞—Ç
