# üé® app/bot/ui/message_formatter.py
"""
üé® message_formatter.py ‚Äî —Ñ–æ—Ä–º–∞—Ç—É—î –¥–∞–Ω—ñ –ø—Ä–æ —Ç–æ–≤–∞—Ä —É HTML-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

üîπ –ö–ª–∞—Å `MessageFormatter`:
- –§–æ—Ä–º–∞—Ç—É—î –≤—Å—ñ —Ç–µ–∫—Å—Ç–æ–≤—ñ –ø–æ–ª—è —Ç–æ–≤–∞—Ä—É –¥–ª—è Telegram.
- –ü–æ–∫–∞–∑—É—î —Å—Ç–∞—Ç—É—Å —Ä–æ–∑–ø—Ä–æ–¥–∞–Ω–æ—Å—Ç—ñ.
- –ì–∞—Ä–∞–Ω—Ç—É—î –∫–æ—Ä–µ–∫—Ç–Ω—É HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—É.
"""

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ –ø—Ä–æ—î–∫—Ç—É
from app.infrastructure.content.product_content_service import ProductContentDTO							    # üì¶ DTO-–∫–ª–∞—Å –∑ –¥–∞–Ω–∏–º–∏ –ø—Ä–æ —Ç–æ–≤–∞—Ä


# ================================
# üèõÔ∏è –ö–õ–ê–° –§–û–†–ú–ê–¢–£–í–ê–õ–¨–ù–ò–ö–ê
# ================================
class MessageFormatter:
	"""
	–ö–ª–∞—Å, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∏–∫–ª—é—á–Ω–æ –∑–∞ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è Telegram.
	"""

	@staticmethod
	def is_fully_sold_out(colors_text: str) -> bool:
		"""
		‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –≤—Å—ñ –ø–æ–∑–∏—Ü—ñ—ó –≤ —Ç–µ–∫—Å—Ç—ñ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –ø–æ–∑–Ω–∞—á–µ–Ω—ñ —è–∫ —Ä–æ–∑–ø—Ä–æ–¥–∞–Ω—ñ.
		–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è "‚ùå –†–û–ó–ü–†–û–î–ê–ù–û ‚ùå".
		
		Args:
			colors_text (str): –¢–µ–∫—Å—Ç, —â–æ –º—ñ—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–ª—å–æ—Ä—ñ–≤ —Ç–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å.

		Returns:
			bool: True ‚Äî —è–∫—â–æ –≤—Å—ñ —Ä—è–¥–∫–∏ –º—ñ—Å—Ç—è—Ç—å "‚ùå".
		"""
		if not colors_text.strip():														                         # ‚ùì –Ø–∫—â–æ —Ç–µ–∫—Å—Ç –ø–æ—Ä–æ–∂–Ω—ñ–π ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ False
			return False
		return all("‚ùå" in line for line in colors_text.splitlines() if line.strip())					         # üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–∂–Ω–æ–≥–æ –Ω–µ–ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ —Ä—è–¥–∫–∞

	@staticmethod
	def format_description(data: ProductContentDTO) -> str:
		"""
		üìù –°—Ç–≤–æ—Ä—é—î HTML-–æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É –∑ –≥–æ—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.

		Args:
			data (ProductContentDTO): DTO –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ —Ç–æ–≤–∞—Ä.

		Returns:
			str: HTML-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –≥–æ—Ç–æ–≤–µ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –≤ Telegram.
		"""
		material = data.sections.get("–ú–ê–¢–ï–†–Ü–ê–õ", "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö")							                          # üßµ –ú–∞—Ç–µ—Ä—ñ–∞–ª —Ç–æ–≤–∞—Ä—É
		fit = data.sections.get("–ü–û–°–ê–î–ö–ê", "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö")								                          # üëñ –ü–æ—Å–∞–¥–∫–∞
		description = data.sections.get("–û–ü–ò–°", "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö")								                      # üìú –û—Å–Ω–æ–≤–Ω–∏–π –æ–ø–∏—Å
		model = data.sections.get("–ú–û–î–ï–õ–¨", "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö")									                      # üë§ –Ü–Ω—Ñ–æ –ø—Ä–æ –º–æ–¥–µ–ª—å –Ω–∞ —Ñ–æ—Ç–æ

		is_sold_out = MessageFormatter.is_fully_sold_out(data.colors_text)						                  # ‚ùå –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ–≤–Ω–∏–π sold-out
		title_display = f"‚ùå –†–û–ó–ü–†–û–î–ê–ù–û ‚ùå\n\n{data.title.upper()}" if is_sold_out else data.title.upper()		 # üî† –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑ –ø–æ–∑–Ω–∞—á–∫–æ—é

		# üß© –ó–±—ñ—Ä–∫–∞ HTML-–æ–ø–∏—Å—É
		return (
			f"<b>{title_display}:</b>\n\n"
			f"<b>–ú–ê–¢–ï–†–Ü–ê–õ:</b> {material}\n"
			f"<b>–ü–û–°–ê–î–ö–ê:</b> {fit}\n"
			f"<b>–û–ü–ò–°:</b> {description}\n\n"
			f"{data.colors_text}\n\n"
			f"<b>–ú–û–î–ï–õ–¨:</b> {model}\n\n"
			f"<b>{data.slogan}</b>\n\n"
			f"<b>{data.hashtags}</b>"
		)																			                               # ‚úÖ –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ–≤–Ω–∏–π HTML-–±–ª–æ–∫
