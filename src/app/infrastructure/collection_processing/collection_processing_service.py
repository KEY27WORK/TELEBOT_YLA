# ‚öôÔ∏è app/infrastructure/collection_processing/collection_processing_service.py
"""
‚öôÔ∏è collection_processing_service.py ‚Äî —Å–µ—Ä–≤—ñ—Å –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω—å –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó.

üîπ –ö–ª–∞—Å `CollectionProcessingService`:
    ‚Ä¢ –ü–∞—Ä—Å–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –∫–æ–ª–µ–∫—Ü—ñ—ó —á–µ—Ä–µ–∑ –ø–∞—Ä—Å–µ—Ä-—Ñ–∞–±—Ä–∏–∫—É
    ‚Ä¢ –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ URL —Ç–æ–≤–∞—Ä—ñ–≤ –∑ —Ü—ñ—î—ó –∫–æ–ª–µ–∫—Ü—ñ—ó
    ‚Ä¢ –õ–æ–≥—É—î —Ö—ñ–¥ –ø—Ä–æ—Ü–µ—Å—É
"""

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
import logging                                                                          # üßæ –õ–æ–≥—É–≤–∞–Ω–Ω—è
from typing import List                                                                 # üìö –¢–∏–ø—ñ–∑–∞—Ü—ñ—è —Å–ø–∏—Å–∫—É

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ –ø—Ä–æ—î–∫—Ç—É
from app.infrastructure.parsers.parser_factory import ParserFactory                     # üè≠ –§–∞–±—Ä–∏–∫–∞ –ø–∞—Ä—Å–µ—Ä—ñ–≤
from app.shared.utils.logger import LOG_NAME                                            # ü™µ –Ü–º º—è –ª–æ–≥–≥–µ—Ä–∞

logger = logging.getLogger(LOG_NAME)                                                    # üßæ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ª–æ–≥–≥–µ—Ä–∞


# ================================
# üèõÔ∏è –ö–õ–ê–° –°–ï–†–í–Ü–°–£ –û–ë–†–û–ë–ö–ò –ö–û–õ–ï–ö–¶–Ü–ô
# ================================
class CollectionProcessingService:
    """
    üìö –Ü–Ω–∫–∞–ø—Å—É–ª—é—î –ª–æ–≥—ñ–∫—É –ø–∞—Ä—Å–∏–Ω–≥—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∫–æ–ª–µ–∫—Ü—ñ—ó
    –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ —Ç–æ–≤–∞—Ä–∏.
    """

    def __init__(self, parser_factory: ParserFactory):
        self.parser_factory = parser_factory								                    # üè≠ –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ñ–∞–±—Ä–∏–∫—É –ø–∞—Ä—Å–µ—Ä—ñ–≤ —è–∫ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å

    async def get_product_links(self, url: str) -> List[str]:
        """
        üîó –ü–∞—Ä—Å–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –∫–æ–ª–µ–∫—Ü—ñ—ó —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ —Ç–æ–≤–∞—Ä–∏.

        Args:
            url (str): üîó –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ–ª–µ–∫—Ü—ñ—é.

        Returns:
            List[str]: üìã –°–ø–∏—Å–æ–∫ –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Ç–æ–≤–∞—Ä—ñ–≤.
        """
        logger.info(f"‚öôÔ∏è –ü–æ—á–∏–Ω–∞—é –ø–∞—Ä—Å–∏–Ω–≥ –ø–æ—Å–∏–ª–∞–Ω—å –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó: {url}")			                    # üßæ –õ–æ–≥ –ø—Ä–æ —Å—Ç–∞—Ä—Ç –æ–±—Ä–æ–±–∫–∏

        collection_parser = self.parser_factory.create_collection_parser(url)		               # üìö –û—Ç—Ä–∏–º—É—î–º–æ –ø–∞—Ä—Å–µ—Ä –∫–æ–ª–µ–∫—Ü—ñ—ó
        product_links = await collection_parser.get_product_links()			                       # üîé –û—Ç—Ä–∏–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ URL

        if not product_links:
            logger.warning(f"‚ö†Ô∏è –ö–æ–ª–µ–∫—Ü—ñ—è –ø–æ—Ä–æ–∂–Ω—è –∞–±–æ –Ω–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä–∏: {url}")	            # ‚ö†Ô∏è –õ–æ–≥ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è

        return product_links											                           # üì§ –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç