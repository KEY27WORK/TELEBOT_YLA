# üìä app/shared/metrics/ocr.py
# -*- coding: utf-8 -*-
"""
üìä –ú–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–ª—è OCR-–ø—Ä–æ—Ü–µ—Å—ñ–≤.

üîπ –í—ñ–¥—Å—Ç–µ–∂—É—î —É—Å–ø—ñ—Ö–∏ —Ç–∞ –∑–±–æ—ó –ø—ñ–¥ —á–∞—Å –ø–∞—Ä—Å–∏–Ω–≥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ OCR.
üîπ –§—ñ–∫—Å—É—î –ø–æ—Ç—Ä–∞–ø–ª—è–Ω–Ω—è —ñ –ø—Ä–æ–º–∞—Ö–∏ –∫–µ—à—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤.
üîπ –î–æ–∑–≤–æ–ª—è—î —Å–µ–≥–º–µ–Ω—Ç—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –¥–∂–µ—Ä–µ–ª–æ–º —Ç–∞ –ø—Ä–∏—á–∏–Ω–æ—é –ø–æ–º–∏–ª–∫–∏.
"""

from __future__ import annotations

# üåê –ó–æ–≤–Ω—ñ—à–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏
from prometheus_client import Counter  # üìà –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è Prometheus-–ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤

# ================================
# ‚úÖ –£–°–ü–Ü–•–ò OCR
# ================================
OCR_SUCCESS = Counter(
    "ocr_success_total",                              # üÜî –ù–∞–∑–≤–∞ –º–µ—Ç—Ä–∏–∫–∏
    "Successful OCR parses",                          # üìù –û–ø–∏—Å –º–µ—Ç—Ä–∏–∫–∏
    labelnames=("source",),                           # üîñ –î–∂–µ—Ä–µ–ª–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, vision API)
)

# ================================
# ‚ùå –ó–ë–û–á OCR
# ================================
OCR_FAILURE = Counter(
    "ocr_failure_total",                              # üÜî –ù–∞–∑–≤–∞ –º–µ—Ç—Ä–∏–∫–∏
    "Failed OCR parses",                              # üìù –û–ø–∏—Å –º–µ—Ç—Ä–∏–∫–∏
    labelnames=("source", "reason"),                  # üîñ –î–∂–µ—Ä–µ–ª–æ + –ø—Ä–∏—á–∏–Ω–∞ (timeout/parse/empty)
)

# ================================
# ‚ôªÔ∏è –ö–ï–® –ü–û–¢–†–ê–ü–õ–Ø–ù–ù–Ø
# ================================
OCR_CACHE_HIT = Counter(
    "ocr_cache_hit_total",                            # üÜî –õ—ñ—á–∏–ª—å–Ω–∏–∫ –ø–æ—Ç—Ä–∞–ø–ª—è–Ω—å —É –∫–µ—à
    "Disk cache hits for OCR results",                # üìù –û–ø–∏—Å –º–µ—Ç—Ä–∏–∫–∏
    labelnames=("source",),                           # üîñ –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–µ—à—É (sha256 —Ç–æ—â–æ)
)

# ================================
# üö´ –ö–ï–® –ü–†–û–ú–ê–•–ò
# ================================
OCR_CACHE_MISS = Counter(
    "ocr_cache_miss_total",                           # üÜî –õ—ñ—á–∏–ª—å–Ω–∏–∫ –ø—Ä–æ–º–∞—Ö—ñ–≤
    "Disk cache misses for OCR results",              # üìù –û–ø–∏—Å –º–µ—Ç—Ä–∏–∫–∏
    labelnames=("source",),                           # üîñ –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–µ—à—É
)

# ================================
# üì¶ –ï–ö–°–ü–û–†–¢ –ú–û–î–£–õ–Ø
# ================================
__all__ = [
    "OCR_SUCCESS",
    "OCR_FAILURE",
    "OCR_CACHE_HIT",
    "OCR_CACHE_MISS",
]
