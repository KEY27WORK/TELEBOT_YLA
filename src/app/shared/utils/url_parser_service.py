# üåç src/app/shared/utils/url_parser_service.py
"""
üåç UrlParserService ‚Äî —Å–µ—Ä–≤—ñ—Å –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –∑–∞ URL.

üîπ –î–µ–ª–µ–≥—É—î –æ–±—Ä–æ–±–∫—É —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è–º, —è–∫—ñ –∑–Ω–∞—é—Ç—å —Å–ø–µ—Ü–∏—Ñ—ñ–∫—É –¥–æ–º–µ–Ω—ñ–≤.
üîπ –ü–æ–≤–µ—Ä—Ç–∞—î –≤–∞–ª—é—Ç—É, –±–∞–∑–æ–≤—ñ –ª—ñ–Ω–∫–∏, —Ä–µ–≥—ñ–æ–Ω–∏ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–Ω—ñ —à–ª—è—Ö–∏.
üîπ –î–∞—î —î–¥–∏–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–±—É–¥–æ–≤–∏ –π –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–æ—Å–∏–ª–∞–Ω—å.
"""

from __future__ import annotations

# üåê –ó–æ–≤–Ω—ñ—à–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏
# (–≤—ñ–¥—Å—É—Ç–Ω—ñ –∑–æ–≤–Ω—ñ—à–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ)

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
import logging										# üßæ –õ–æ–≥—É–≤–∞–Ω–Ω—è –¥—ñ–π —Å–µ—Ä–≤—ñ—Å—É
from typing import List, Optional					# üß∞ –¢–∏–ø–∏ –¥–ª—è –∞–Ω–æ—Ç–∞—Ü—ñ–π
from urllib.parse import urlparse					# üîé –†–æ–∑–±—ñ—Ä URL –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ –ø—Ä–æ—î–∫—Ç—É
from app.shared.utils.logger import LOG_NAME		# üè∑Ô∏è –ë–∞–∑–æ–≤–∞ –Ω–∞–∑–≤–∞ –ª–æ–≥–µ—Ä–∞
from .interfaces import IUrlParsingStrategy			# üß† –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π —Ä–æ–∑–±–æ—Ä—É

logger = logging.getLogger(f"{LOG_NAME}.url")		# üßæ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —ñ–º–µ–Ω–æ–≤–∞–Ω–æ–≥–æ –ª–æ–≥–µ—Ä–∞


# ================================
# üèõÔ∏è –°–ï–†–í–Ü–° –†–û–ó–ë–û–†–£ URL
# ================================
class UrlParserService:
    """
    üèõÔ∏è –Ü–Ω–∫–∞–ø—Å—É–ª—é—î –Ω–∞–±—ñ—Ä —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –ø–æ—Å–∏–ª–∞–Ω—å.

    –°–µ—Ä–≤—ñ—Å –ø—ñ–¥–±–∏—Ä–∞—î —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –∑–∞ –¥–æ–º–µ–Ω–æ–º —ñ –Ω–∞–¥–∞—î –º–µ—Ç–æ–¥–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–∞–ª—é—Ç,
    —Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–∏—Ö –º—ñ—Ç–æ–∫, –ø–æ–±—É–¥–æ–≤–∏ –ø—Ä–æ–¥—É–∫—Ç–Ω–∏—Ö URL —Ç–∞ —ñ–Ω—à–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–∏—Ö.
    """

    # ================================
    # ‚öôÔ∏è –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
    # ================================
    def __init__(self, strategies: List[IUrlParsingStrategy]) -> None:
        """
        ‚öôÔ∏è –ó–±–µ—Ä—ñ–≥–∞—î —ñ–Ω–∂–µ–∫—Ç–æ–≤–∞–Ω—ñ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó –¥–ª—è —Ä–æ–±–æ—á–æ–≥–æ —Ü–∏–∫–ª—É.

        Args:
            strategies (List[IUrlParsingStrategy]): –ü–µ—Ä–µ–ª—ñ–∫ —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π, –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏—Ö –∑–∞ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º.
        """
        self._strategies = list(strategies)			# ‚ôªÔ∏è –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–ø—ñ—é —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –º—É—Ç–∞—Ü—ñ–π

    # ================================
    # üö™ –ü–£–ë–õ–Ü–ß–ù–ò–ô –Ü–ù–¢–ï–†–§–ï–ô–°
    # ================================
    def get_currency(self, url: str, default: Optional[str] = None) -> Optional[str]:
        """
        üí± –ü–æ–≤–µ—Ä—Ç–∞—î –≤–∞–ª—é—Ç—É –¥–ª—è –ø–µ—Ä–µ–¥–∞–Ω–æ–≥–æ URL, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é.

        Args:
            url (str): –ü–æ—Å–∏–ª–∞–Ω–Ω—è, –¥–ª—è —è–∫–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –≤–∞–ª—é—Ç—É.
            default (str | None): –ó–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, —è–∫—â–æ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –≤–∞–ª—é—Ç—É –Ω–µ –≤–¥–∞–ª–æ—Å—è.

        Returns:
            Optional[str]: –ö–æ–¥ –≤–∞–ª—é—Ç–∏ –∞–±–æ default, —è–∫—â–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞ —á–∏ –Ω–µ –¥–∞–ª–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
        """
        prepared_url = (url or "").strip()			# ‚úÇÔ∏è –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –∑–∞–π–≤—ñ –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ –∑–∞—Ö–∏—â–∞—î–º–æ—Å—è –≤—ñ–¥ None
        if not prepared_url:
            logger.warning("‚ö†Ô∏è get_currency: –ø–æ—Ä–æ–∂–Ω—ñ–π URL ‚Üí –ø–æ–≤–µ—Ä—Ç–∞—é default=%r", default)		# üì£ –õ–æ–≥—É—î–º–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è
            return default							# ‚Ü©Ô∏è –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–∞–ø–∞—Å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è

        strategy = self._pick(prepared_url)			# üß† –ü—ñ–¥–±–∏—Ä–∞—î–º–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –∑–∞ –¥–æ–º–µ–Ω–æ–º
        if not strategy:
            domain = urlparse(prepared_url).netloc	# üåê –î—ñ—Å—Ç–∞—î–º–æ –¥–æ–º–µ–Ω –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
            logger.warning("‚ö†Ô∏è get_currency: –¥–ª—è –¥–æ–º–µ–Ω—É '%s' –Ω–µ–º–∞—î —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó ‚Üí default=%r", domain, default)		# üì£ –ü–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó
            return default							# ‚Ü©Ô∏è –í—ñ–¥–¥–∞—î–º–æ –∑–∞–ø–∞—Å–Ω—É –≤–∞–ª—é—Ç—É

        currency = strategy.get_currency(prepared_url)	# üí± –î–µ–ª–µ–≥—É—î–º–æ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤–∞–ª—é—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó
        if not currency:
            logger.warning(
                "‚ö†Ô∏è get_currency: —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è %s –Ω–µ –Ω–∞–¥–∞–ª–∞ –≤–∞–ª—é—Ç—É –¥–ª—è '%s' ‚Üí default=%r",
                type(strategy).__name__,
                prepared_url,
                default,
            )										# üì£ –§—ñ–∫—Å—É—î–º–æ –Ω–µ–≤–¥–∞–ª—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó
            return default							# ‚Ü©Ô∏è –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º

        return currency								# ‚úÖ –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–Ω–∞–π–¥–µ–Ω—É –≤–∞–ª—é—Ç—É

    def get_region_label(self, url: str) -> str:
        """
        üó∫Ô∏è –ü–æ–≤–µ—Ä—Ç–∞—î –ª—é–¥–∏–Ω–æ–∑—Ä–æ–∑—É–º—ñ–ª—É –Ω–∞–∑–≤—É —Ä–µ–≥—ñ–æ–Ω—É –∑–∞ URL.

        Args:
            url (str): –ü–æ—Å–∏–ª–∞–Ω–Ω—è, –¥–ª—è —è–∫–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω –æ–ø–∏—Å —Ä–µ–≥—ñ–æ–Ω—É.

        Returns:
            str: –†–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–∞ –º—ñ—Ç–∫–∞ –∞–±–æ 'Unknown', —è–∫—â–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞.
        """
        strategy = self._pick(url)					# üß† –í–∏–±–∏—Ä–∞—î–º–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é
        return strategy.get_region_label(url) if strategy else "Unknown"		# üè∑Ô∏è –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –º—ñ—Ç–∫—É –∞–±–æ –¥–µ—Ñ–æ–ª—Ç

    def get_base_url(self, currency: str) -> Optional[str]:
        """
        üè¶ –ü–æ–≤–µ—Ä—Ç–∞—î –±–∞–∑–æ–≤—É –∞–¥—Ä–µ—Å—É –º–∞–≥–∞–∑–∏–Ω—É –¥–ª—è –≤–∫–∞–∑–∞–Ω–æ—ó –≤–∞–ª—é—Ç–∏.

        Args:
            currency (str): –ö–æ–¥ –≤–∞–ª—é—Ç–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 'USD' —á–∏ 'UAH'.

        Returns:
            Optional[str]: –ë–∞–∑–æ–≤–∏–π URL –∞–±–æ None, —è–∫—â–æ –∂–æ–¥–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –Ω–µ –∑–Ω–∞—î –π–æ–≥–æ.
        """
        for strategy in self._strategies:
            base_url = strategy.get_base_url(currency)		# üè† –ó–∞–ø–∏—Ç—É—î–º–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—á–Ω—É –±–∞–∑–æ–≤—É –∞–¥—Ä–µ—Å—É
            if base_url:
                return base_url							# ‚úÖ –ó–Ω–∞—Ö–æ–¥–∏–º–æ –π –æ–¥—Ä–∞–∑—É –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è
        return None										# ‚Ü©Ô∏è –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π—à–ª–∏ ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ None

    def build_product_url(self, region_code: str, product_path: str) -> Optional[str]:
        """
        üß± –ö–æ–Ω—Å—Ç—Ä—É—é—î –ø–æ–≤–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç –∑–∞ –∫–æ–¥–æ–º —Ä–µ–≥—ñ–æ–Ω—É —Ç–∞ —à–ª—è—Ö–æ–º.

        Args:
            region_code (str): –ö–æ–¥ —Ä–µ–≥—ñ–æ–Ω—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 'us', 'eu').
            product_path (str): –®–ª—è—Ö –ø—Ä–æ–¥—É–∫—Ç—É –≤—ñ–¥–Ω–æ—Å–Ω–æ –±–∞–∑–æ–≤–æ–≥–æ URL.

        Returns:
            Optional[str]: –ü–æ–≤–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∞–±–æ None, —è–∫—â–æ –∂–æ–¥–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ä–µ–≥—ñ–æ–Ω.
        """
        for strategy in self._strategies:
            product_url = strategy.build_product_url(region_code, product_path)		# üõ†Ô∏è –î–µ–ª–µ–≥—É—î–º–æ –ø–æ–±—É–¥–æ–≤—É –ª—ñ–Ω–∫–∞
            if product_url:
                return product_url							# ‚úÖ –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–Ω–∞–π–¥–µ–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è
        return None											# ‚Ü©Ô∏è –Ø–∫—â–æ –ø–æ–±—É–¥–æ–≤–∞ –Ω–µ –≤–¥–∞–ª–∞—Å—è ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ None

    def is_product_url(self, url: str) -> bool:
        """
        üß™ –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —î –ø—Ä–æ–¥—É–∫—Ç–Ω–æ—é —Å—Ç–æ—Ä—ñ–Ω–∫–æ—é.

        Args:
            url (str): –ü–µ—Ä–µ–≤—ñ—Ä—é–≤–∞–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.

        Returns:
            bool: True, —è–∫—â–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–ª–∞ –ø—Ä–æ–¥—É–∫—Ç–Ω–∏–π URL, —ñ–Ω–∞–∫—à–µ False.
        """
        strategy = self._pick(url)							# üß† –ü—ñ–¥–±–∏—Ä–∞—î–º–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
        return strategy.is_product_url(url) if strategy else False	# üîç –î–µ–ª–µ–≥—É—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –∞–±–æ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ False

    def is_collection_url(self, url: str) -> bool:
        """
        üìÇ –ì—Ä—É–±–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤–µ–¥–µ –Ω–∞ –∫–æ–ª–µ–∫—Ü—ñ—é (–±–µ–∑ —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π).

        Args:
            url (str): –ü–æ—Å–∏–ª–∞–Ω–Ω—è, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∫–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏.

        Returns:
            bool: True, —è–∫—â–æ URL –º—ñ—Å—Ç–∏—Ç—å –º–∞—Ä–∫–µ—Ä–∏ –∫–æ–ª–µ–∫—Ü—ñ—ó, False —ñ–Ω–∞–∫—à–µ.
        """
        prepared_url = (url or "").lower()					# üî° –ì–æ—Ç—É—î–º–æ URL –¥–æ –ø–æ—à—É–∫—É –ø–∞—Ç–µ—Ä–Ω—ñ–≤
        return "/collections/" in prepared_url or "/category/" in prepared_url		# üìö –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–ª—é—á–æ–≤—ñ –ø—ñ–¥—Ä—è–¥–∫–∏

    def extract_product_slug(self, url: str) -> Optional[str]:
        """
        üè∑Ô∏è –í–∏–¥–æ–±—É–≤–∞—î –ø—Ä–æ–¥—É–∫—Ç–Ω–∏–π slug –∑ URL.

        Args:
            url (str): –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç.

        Returns:
            Optional[str]: Slug –ø—Ä–æ–¥—É–∫—Ç—É –∞–±–æ None, —è–∫—â–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞.
        """
        strategy = self._pick(url)							# üß† –ü—ñ–¥–±–∏—Ä–∞—î–º–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –¥–ª—è —Ä–æ–∑–±–æ—Ä—É
        return strategy.extract_product_slug(url) if strategy else None	# üè∑Ô∏è –û—Ç—Ä–∏–º—É—î–º–æ slug –∞–±–æ None

    def normalize(self, raw: str) -> str:
        """
        üßº –ó–¥—ñ–π—Å–Ω—é—î –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é URL (–æ–±—Ä—ñ–∑–∫–∞ –ø—Ä–æ–±—ñ–ª—ñ–≤ —Ç–æ—â–æ).

        Args:
            raw (str): –ü–æ—á–∞—Ç–∫–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, —è–∫–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É.

        Returns:
            str: –ù–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π URL –±–µ–∑ –∑–∞–π–≤–∏—Ö –ø—Ä–æ–±—ñ–ª—ñ–≤.
        """
        normalized = (raw or "").strip()					# ‚úÇÔ∏è –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ –∑–∞—Ö–∏—â–∞—î–º–æ—Å—è –≤—ñ–¥ None
        return normalized									# ‚Ü©Ô∏è –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –æ—á–∏—â–µ–Ω–∏–π —Ä—è–¥–æ–∫

    # ================================
    # üß∞ –î–û–ü–û–ú–Ü–ñ–ù–Ü –ú–ï–¢–û–î–ò
    # ================================
    def _pick(self, url: str) -> Optional[IUrlParsingStrategy]:
        """
        üéØ –û–±–∏—Ä–∞—î –ø–µ—Ä—à—É —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é, —è–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î –¥–æ–º–µ–Ω –ø–µ—Ä–µ–¥–∞–Ω–æ–≥–æ URL.

        Args:
            url (str): –ü–æ—Å–∏–ª–∞–Ω–Ω—è, –¥–æ–º–µ–Ω —è–∫–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏.

        Returns:
            Optional[IUrlParsingStrategy]: –í—ñ–¥–ø–æ–≤—ñ–¥–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –∞–±–æ None, —è–∫—â–æ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—è.
        """
        domain = (urlparse(url).netloc or "").lower().replace("www.", "")	# üåê –ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –¥–æ–º–µ–Ω –¥–æ –±–∞–∑–æ–≤–æ–≥–æ –≤–∏–≥–ª—è–¥—É
        for strategy in self._strategies:
            if strategy.supports(domain):
                return strategy							# ‚úÖ –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–µ—Ä—à—É —Å—É–º—ñ—Å–Ω—É —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é
        return None										# ‚Ü©Ô∏è –°—Ç—Ä–∞—Ç–µ–≥—ñ–π –¥–ª—è –¥–æ–º–µ–Ω—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
