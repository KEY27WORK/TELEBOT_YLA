# üóÉÔ∏è Data Storage Infrastructure

–Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏–π —à–∞—Ä –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö –ª–æ–∫–∞–ª—å–Ω–∏—Ö —Å—Ö–æ–≤–∏—â (—Ñ–∞–π–ª–∏, –∫–µ—à—ñ, lightweight –±–∞–∑–∏).

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```bash
data_storage/
‚îú‚îÄ‚îÄ üìò README.md           # (—Ü–µ–π —Ñ–∞–π–ª)
‚îú‚îÄ‚îÄ üìÑ __init__.py         # –µ–∫—Å–ø–æ—Ä—Ç—É—î WeightDataService
‚îî‚îÄ‚îÄ üìÑ weight_data_service.py  # –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ —Å—Ö–æ–≤–∏—â–µ –≤–∞–≥ —É JSON
```

---

## üß≠ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

- –ì–æ—Å—Ç–∏—Ç—å **–ø—Ä–∏–∫–ª–∞–¥–Ω—ñ —Å—Ö–æ–≤–∏—â–∞**, —â–æ –Ω–µ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –æ–∫—Ä–µ–º–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ (JSON/–∫–µ—à—ñ).
- –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–æ–≤–∏–Ω–Ω—ñ –¥–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤ –¥–æ–º–µ–Ω—É (`IWeightDataProvider` —Ç–æ—â–æ).
- –£—Å—è –Ω–µ–±—ñ–∑–Ω–µ—Å–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ (—à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É, debounce, –∫–µ—à) —ñ–Ω–∫–∞–ø—Å—É–ª—å–æ–≤–∞–Ω–∞ —Ç—É—Ç, —â–æ–± –¥–æ–º–µ–Ω –º—ñ–≥ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –≤–∞–≥–∏ —á–µ—Ä–µ–∑ —á–∏—Å—Ç–∏–π API.

---

## üß± –°–µ—Ä–≤—ñ—Å–∏

- **`weight_data_service.py`**
  - –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è `WeightDataService`.
  - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î in-memory –∫–µ—à + JSON-—Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫—É (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —Ä–æ–±–æ—Ç–∞ —á–µ—Ä–µ–∑ `aiofiles`).
  - –ü—ñ–¥—Ç—Ä–∏–º—É—î debounced-–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–∞ –∫–æ–Ω–≤–µ—Ä—Ç—É—î —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ (–∫–≥/float/str) —É –≥—Ä–∞–º–∏.
  - –í–∞–≥–∞ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –≥—Ä–∞–º–∞—Ö (`int`), –±–µ–∑ `float`.

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

```yaml
files:
  weights: "var/data/weights.json"   # —à–ª—è—Ö –¥–æ JSON
weights:
  flush_sec: 1.5                     # debounce-–∑–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å–æ–º
  ensure_dir: true                   # —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
```

---

## üöÄ –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```python
from app.config.config_service import ConfigService
from app.infrastructure.data_storage import WeightDataService

config = ConfigService()
weight_store = WeightDataService(config)

all_weights = await weight_store.get_all_weights()      # {"hoodie": 980, "tee": 260}
await weight_store.update_weight("Hoodie", 980)         # –∫–ª—é—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î—Ç—å—Å—è
```

---

## üîó –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–æ–º–µ–Ω—É

–°–µ—Ä–≤—ñ—Å —Ä–µ–∞–ª—ñ–∑—É—î `IWeightDataProvider` –∑ `app/domain/products/interfaces.py`:

```python
class IWeightDataProvider(Protocol):
    async def get_all_weights(self) -> Dict[str, int]: ...
    async def update_weight(self, keyword: str, weight_g: int) -> None: ...
```

---

## ‚úÖ –ü—Ä–∏–º—ñ—Ç–∫–∏
- –°–µ—Ä–≤—ñ—Å –Ω–µ –≤–∏–∫–æ–Ω—É—î IO –≤ `__init__`, –ª–∏—à–µ –≤ –æ–∫—Ä–µ–º–∏—Ö –º–µ—Ç–æ–¥–∞—Ö.
- JSON-—Ñ–æ—Ä–º–∞—Ç –∑–±–µ—Ä—ñ–≥–∞—î **—É—Å—ñ** –≤–∞–≥–∏; –∑–∞–ø–∏—Å –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–∞—á–∫–∞–º–∏ (–∞—Ç–æ–º—ñ—á–Ω–∏–π rename).
- –ú–æ–∂–ª–∏–≤—ñ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è: –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ —Ñ–æ–Ω–æ–≤a –∑–∞–ø–∏—Å –∑–∞ —Ç–∞–π–º–µ—Ä–æ–º, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º–µ–Ω—à–∏—Ç–∏ IO.
