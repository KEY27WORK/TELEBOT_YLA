# üöö app/domain/delivery/interfaces.py
"""
üöö –î–æ–º–µ–Ω–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω—ñ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏ –¥–ª—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏.

üîπ –ì—Ä–æ—à—ñ ‚Äî —Ç—ñ–ª—å–∫–∏ Decimal; –∂–æ–¥–Ω–∏—Ö float –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–æ—Ö–∏–±–æ–∫.
üîπ –í–∞–≥–∞ ‚Äî —É –≥—Ä–∞–º–∞—Ö (int) –¥–ª—è –≤—Ö—ñ–¥–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Ç–∞ —Ç–∞—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.
üîπ –ö–æ–Ω—Ç—Ä–∞–∫—Ç–∏ —á–∏—Å—Ç—ñ, –±–µ–∑ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —ñ –∑ –ø–æ–≤–∞–≥–æ—é –¥–æ asyncio.CancelledError.
"""

from __future__ import annotations                                                   # ‚è≥ –î–æ–∑–≤–æ–ª—è—î –ø–æ—Å–∏–ª–∞—Ç–∏—Å—è –Ω–∞ —Ç–∏–ø–∏ –Ω–∏–∂—á–µ

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
import logging                                                                       # üßæ –Ñ–¥–∏–Ω–µ –¥–∂–µ—Ä–µ–ª–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è
from abc import ABC, abstractmethod                                                  # üèõÔ∏è –ë–∞–∑–æ–≤–∏–π –∫–ª–∞—Å –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª—É
from dataclasses import dataclass                                                    # üß± DTO –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
from decimal import Decimal                                                          # üíµ –¢–æ—á–Ω—ñ –≥—Ä–æ—à–æ–≤—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏
from typing import Optional                                                          # üß∞ –ê–Ω–æ—Ç–∞—Ü—ñ—è –¥–ª—è –Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ –ø—Ä–æ—î–∫—Ç—É
from app.shared.utils.logger import LOG_NAME                                         # üè∑Ô∏è –ë–∞–∑–æ–≤–µ —ñ–º'—è –ª–æ–≥–µ—Ä–∞


# ================================
# üßæ –õ–û–ì–ï–† –ú–û–î–£–õ–Ø
# ================================
MODULE_LOGGER_NAME: str = f"{LOG_NAME}.domain.delivery.interfaces"                   # üè∑Ô∏è –Ü–º–µ–Ω–æ–≤–∞–Ω–∏–π –ø—Ä–µ—Ñ—ñ–∫—Å
logger = logging.getLogger(MODULE_LOGGER_NAME)                                       # üßæ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –ª–æ–≥–µ—Ä
logger.debug("üöö delivery.interfaces —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ")                                    # üöÄ –§—ñ–∫—Å—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥—É–ª—è


# ================================
# üèõÔ∏è DTO –†–ï–ó–£–õ–¨–¢–ê–¢–£ –†–û–ó–†–ê–•–£–ù–ö–£
# ================================
@dataclass(frozen=True, slots=True)
class DeliveryQuote:
    """
    üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∞—Ä—Ç–æ—Å—Ç—ñ –¥–æ—Å—Ç–∞–≤–∫–∏.
    """

    price: Decimal                                                                    # üíµ –ü—ñ–¥—Å—É–º–∫–æ–≤–∞ —Ü—ñ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
    currency: str                                                                      # üí± –í–∞–ª—é—Ç–∞ ISO-–∫–æ–¥—É (str, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Ü–∏–∫–ª—ñ–≤)
    service_code: str                                                                  # üè∑Ô∏è –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Å–µ—Ä–≤—ñ—Å—É/—Ç–∞—Ä–∏—Ñ—É
    billed_weight_g: int                                                               # ‚öñÔ∏è –¢–∞—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∞ –≤–∞–≥–∞ —É –≥—Ä–∞–º–∞—Ö

    def __post_init__(self) -> None:
        """
        –ü–µ—Ä–µ–≤—ñ—Ä—è—î –±–∞–∑–æ–≤—ñ —ñ–Ω–≤–∞—Ä—ñ–∞–Ω—Ç–∏ —Ç–∞ –ª–æ–≥—É—î —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
        """
        logger.debug(
            "üì¶ DeliveryQuote —Å—Ç–≤–æ—Ä–µ–Ω–æ | price=%s %s service=%s billed=%s –≥",
            self.price,
            self.currency,
            self.service_code,
            self.billed_weight_g,
        )                                                                             # üßæ –§—ñ–∫—Å—É—î–º–æ DTO
        if self.price < Decimal("0"):                                                 # üö´ –í–∞—Ä—Ç—ñ—Å—Ç—å –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥‚Äô—î–º–Ω–æ—é
            logger.warning("‚ö†Ô∏è DeliveryQuote price<0 | price=%s service=%s", self.price, self.service_code)
        if self.billed_weight_g < 0:                                                  # üö´ –í–∞–≥–∞ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥‚Äô—î–º–Ω–æ—é
            logger.warning("‚ö†Ô∏è DeliveryQuote billed_weight<0 | service=%s", self.service_code)


# ================================
# üèõÔ∏è –Ü–ù–¢–ï–†–§–ï–ô–° –°–ï–†–í–Ü–°–£ –î–û–°–¢–ê–í–ö–ò
# ================================
class IDeliveryService(ABC):
    """
    üöö –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è —Å–µ—Ä–≤—ñ—Å—É —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∞—Ä—Ç–æ—Å—Ç—ñ –¥–æ—Å—Ç–∞–≤–∫–∏.

    –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞:
      ‚Ä¢ –ë—É—Ç–∏ —ñ–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—é –¥–ª—è –æ–¥–Ω–∞–∫–æ–≤–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤.
      ‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —ñ (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏) –Ω–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∞–≥—É —Ç–∞ –º–µ—Ç–æ–¥–∏ —Ç–∞—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.
      ‚Ä¢ –ü–æ–≤–µ—Ä—Ç–∞—Ç–∏ –≤–∞–ª—ñ–¥–Ω–∏–π DeliveryQuote –∞–±–æ –∫–∏–Ω—É—Ç–∏ –¥–æ–º–µ–Ω–Ω–∏–π –≤–∏–Ω—è—Ç–æ–∫.
    """

    @abstractmethod
    def quote(
        self,
        *,
        country: str,                                                                  # üåç ISO-2: "UA", "PL", ...
        method: str,                                                                   # üöõ –ù–∞–ø—Ä., "air" | "ground"
        type_: str,                                                                    # üì¶ "parcel" | "letter"
        weight_g: int,                                                                 # ‚öñÔ∏è –§–∞–∫—Ç–∏—á–Ω–∞ –≤–∞–≥–∞, –≥
        volumetric_weight_g: Optional[int] = None,                                     # üìê –û–±‚Äô—î–º–Ω–∞ –≤–∞–≥–∞, –≥
    ) -> DeliveryQuote:
        """
        üìê –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤–∞—Ä—Ç—ñ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏.

        Args:
            country: üåç –ö–æ–¥ –∫—Ä–∞—ó–Ω–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è (ISO‚Äë3166‚Äë1 alpha‚Äë2).
            method:  üöõ –ú–µ—Ç–æ–¥/–∫–∞–Ω–∞–ª –¥–æ—Å—Ç–∞–≤–∫–∏.
            type_:   üì¶ –¢–∏–ø –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è.
            weight_g: ‚öñÔ∏è –§–∞–∫—Ç–∏—á–Ω–∞ –≤–∞–≥–∞ —É –≥—Ä–∞–º–∞—Ö.
            volumetric_weight_g: üìê –û–±‚Äô—î–º–Ω–∞ –≤–∞–≥–∞ —É –≥—Ä–∞–º–∞—Ö (–æ–ø—Ü—ñ–π–Ω–æ).

        Returns:
            DeliveryQuote: –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —ñ–∑ Decimal-—Ü—ñ–Ω–æ—é —Ç–∞ —Ç–∞—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ—é –≤–∞–≥–æ—é.
        """
        ...


logger.debug("üöö IDeliveryService protocol –∑–∞–¥–µ–∫–ª–∞—Ä–æ–≤–∞–Ω–æ")                            # üßæ –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–æ—Å—Ç—É–ø–Ω–∏–π


# ================================
# üì¶ –ü–£–ë–õ–Ü–ß–ù–ò–ô API –ú–û–î–£–õ–Ø
# ================================
__all__ = ["DeliveryQuote", "IDeliveryService"]                                       # üßæ –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ —Å–∏–º–≤–æ–ª–∏
logger.debug("üîì __all__ –æ–≥–æ–ª–æ—à–µ–Ω–æ: %s", __all__)                                     # üì£ –§—ñ–∫—Å—É—î–º–æ –ø—É–±–ª—ñ—á–Ω–∏–π API
