# üõ°Ô∏è app/errors
–Ñ–¥–∏–Ω–∏–π —à–∞—Ä –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏ –≤–∏–Ω—è—Ç–∫—ñ–≤ —É –±–æ—Ç—ñ: –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î, –∫–æ–Ω–≤–µ—Ä—Ç—É—î —É `AppError`, –ø—ñ–¥–±–∏—Ä–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É —Ç–∞ –≤–µ–¥–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –ª–æ–≥–∏.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
errors/
‚îú‚îÄ‚îÄ üìò README.md
‚îú‚îÄ‚îÄ üìÑ __init__.py
‚îú‚îÄ‚îÄ üìÑ custom_errors.py
‚îú‚îÄ‚îÄ üìÑ exception_handler_service.py
‚îú‚îÄ‚îÄ üìÑ error_handler.py
‚îú‚îÄ‚îÄ üìÑ strategies.py
‚îú‚îÄ‚îÄ üìÑ reason_codes.py
‚îî‚îÄ‚îÄ üìÑ reason_mapper.py
```

---

## üß≠ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
- –ù–∞–¥–∞—Ç–∏ **—î–¥–∏–Ω—É —Ç–æ—á–∫—É —ñ–º–ø–æ—Ä—Ç—É** (`app.errors`) –¥–ª—è –≤—Å—ñ—Ö –ø—É–±–ª—ñ—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫/—Å–µ—Ä–≤—ñ—Å—ñ–≤.  
- –ü–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ –≤–∏–Ω—è—Ç–∫–∏ (OpenAI, httpx, Telegram) —É –¥–æ–º–µ–Ω–Ω—ñ `AppError` –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π.  
- –í–∏–∑–Ω–∞—á–∞—Ç–∏, —â–æ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É, –∞ —â–æ –ª–æ–≥—É–≤–∞—Ç–∏ (—á–µ—Ä–µ–∑ `ReasonCode` + `reason_mapper`).  
- –ì–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏, —â–æ async-—Ö–µ–Ω–¥–ª–µ—Ä–∏ –Ω–µ –ø–∞–¥–∞—é—Ç—å: `error_handler` –∑–∞–≥–æ—Ä—Ç–∞—î —ó—Ö —É –±–µ–∑–ø–µ—á–Ω–∏–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä.

---

## üß© –ö–ª—é—á–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
- **`custom_errors.py`** ‚Äî —à–ª—é–∑ —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ: –∑–±–µ—Ä—ñ–≥–∞—î —Å—Ç–∞—Ä—ñ —ñ–º–µ–Ω–∞ (`AppError`, `UserVisibleError`, `NetworkRequestError`, `ParsingError`).  
- **`exception_handler_service.py`** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤—ñ—Å (DI-friendly): –æ–ø–∏—Ç—É—î —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó, –≤–∏–∑–Ω–∞—á–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É.  
- **`error_handler.py`** ‚Äî —Ñ–∞–±—Ä–∏–∫–∞ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ñ–≤, —è–∫–∞ –ø—ñ–¥–∫–ª—é—á–∞—î —Å–µ—Ä–≤—ñ—Å –¥–æ Telegram/typedi-—Ö–µ–Ω–¥–ª–µ—Ä—ñ–≤.  
- **`strategies.py`** ‚Äî –Ω–∞–±—ñ—Ä —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π (`OpenAI`, `Httpx`, `Telegram`); –ª–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ —Å–≤—ñ–π –∫–ª–∞—Å, —è–∫—â–æ –∑‚Äô—è–≤–∏—Ç—å—Å—è –Ω–æ–≤–µ –¥–∂–µ—Ä–µ–ª–æ –ø–æ–º–∏–ª–æ–∫.  
- **`reason_codes.py`** ‚Äî –ø–µ—Ä–µ–ª—ñ–∫ `ReasonCode` –¥–ª—è —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —ñ –º–µ—Ç—Ä–∏–∫.  
- **`reason_mapper.py`** ‚Äî —Ñ—É–Ω–∫—Ü—ñ—è `map_error_to_reason` (–≤–∏–Ω—è—Ç–æ–∫ ‚Üí –∫–æ–¥ + –∫–æ–Ω—Ç–µ–∫—Å—Ç).  
- **`__init__.py`** ‚Äî –µ–∫—Å–ø–æ—Ä—Ç—É—î –ø—É–±–ª—ñ—á–Ω–∏–π API (`AppError`, `ExceptionHandlerService`, `make_error_handler`, —Ç–æ—â–æ).

---

## üöÄ –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
```python
from app.errors import ExceptionHandlerService, make_error_handler
from app.errors.strategies import (
    OpenAIErrorStrategy,
    HttpxErrorStrategy,
    TelegramErrorStrategy,
)

service = ExceptionHandlerService([
    OpenAIErrorStrategy(),
    HttpxErrorStrategy(),
    TelegramErrorStrategy(),
])
error_handler = make_error_handler(service)

@error_handler
async def on_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    ...
```

---

## ‚úÖ –ü—Ä–∏–º—ñ—Ç–∫–∏
- –ù–æ–≤—ñ –¥–∂–µ—Ä–µ–ª–∞ –ø–æ–º–∏–ª–æ–∫ ‚Äî –¥–æ–¥–∞–≤–∞–π—Ç–µ —á–µ—Ä–µ–∑ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é; `ExceptionHandlerService` —á—ñ–ø–∞—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.  
- –ù–µ –≥–ª–æ—Ç–∞–π—Ç–µ `asyncio.CancelledError`: —Å–µ—Ä–≤—ñ—Å –æ–¥—Ä–∞–∑—É –ø—Ä–æ–∫–∏–¥—É—î —ó—ó –¥–∞–ª—ñ.  
- `reason_codes.py` + `reason_mapper.py` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –ø—Ä–µ–∑–µ–Ω—Ç–µ—Ä–æ–º (`app.bot.ui.error_presenter`) ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–π—Ç–µ –∫–æ–¥–∏ –∑ —Ç–µ–∫—Å—Ç–∞–º–∏.  
- –ü—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ —Å—Ç–∞—Ä–∏—Ö –ª–µ–≥–∞—Å—ñ-–∫–ª–∞—Å—ñ–≤ –æ–Ω–æ–≤–ª—é–π—Ç–µ `custom_errors.py`, –∞–ª–µ –Ω–µ –ø—Ä–∏–±–∏—Ä–∞–π—Ç–µ –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏: –≤—ñ–Ω –∑–∞–±–µ–∑–ø–µ—á—É—î –ø–æ—Å—Ç—É–ø–æ–≤—É –º—ñ–≥—Ä–∞—Ü—ñ—é.
