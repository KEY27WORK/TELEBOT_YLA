# ‚ôªÔ∏è Cache (HTML caching layer)

–ü–∞–∫–µ—Ç **`app/shared/cache`** –∑–∞–±–µ–∑–ø–µ—á—É—î –ø–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è HTML-–¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
–¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ (–ø–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä—ñ–≤, OCR —Ç–æ—â–æ). –ú–µ—Ç–∞ ‚Äî –∑–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å
–º–µ—Ä–µ–∂–µ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ —ñ —É–Ω–∏–∫–∞—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –∑–æ–≤–Ω—ñ—à–Ω—ñ —Å–∞–π—Ç–∏.

## üì¶ –°–∫–ª–∞–¥

- `html_lru_cache.py` ‚Äî –ø—Ä–æ—Ü–µ—Å–Ω–∏–π **LRU+TTL –∫–µ—à** —ñ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º–∏ locks:
  - LRU –Ω–∞ `OrderedDict` –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.
  - TTL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫.
  - –ü–µ—Ä-–∫–ª—é—á–æ–≤—ñ `asyncio.Lock`, —â–æ–± –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏ ¬´–∑–ª–∏–≤–∞–ª–∏—Å—è¬ª –≤ –æ–¥–∏–Ω.
- `__init__.py` ‚Äî –µ–∫—Å–ø–æ—Ä—Ç—É—î `HtmlLruCache` —è–∫ –ø—É–±–ª—ñ—á–Ω–∏–π API –ø–∞–∫–µ—Ç—É.

```bash
‚ôªÔ∏è cache/
‚îú‚îÄ‚îÄ üìò README.md       # –ø—É—Ç—ñ–≤–Ω–∏–∫ –ø–æ –∫–µ—à—É
‚îú‚îÄ‚îÄ üìÑ __init__.py     # –µ–∫—Å–ø–æ—Ä—Ç—É—î HtmlLruCache
‚îî‚îÄ‚îÄ üìÑ html_lru_cache.py
```

## üß≠ –ü–æ—Ç–æ–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

- –°–µ—Ä–≤—ñ—Å —Ä–æ–±–∏—Ç—å `await HtmlLruCache().get(key)` –ø–µ—Ä–µ–¥ HTTP/WebDriver-–∑–∞–ø–∏—Ç–æ–º.
- –Ø–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–µ–º–∞—î ‚Üí –æ—Ç—Ä–∏–º—É—î lock —á–µ—Ä–µ–∑ `key_lock`, –≤–∏–∫–æ–Ω—É—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è,
  –ø–æ—Ç—ñ–º `set()` –∑–±–µ—Ä—ñ–≥–∞—î HTML.
- –ü–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –∫–æ—Ä—É—Ç–∏–Ω–∏ –¥–ª—è —Ç–æ–≥–æ —Å–∞–º–æ–≥–æ –∫–ª—é—á–∞ —á–µ–∫–∞—é—Ç—å –Ω–∞ lock —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∫–µ—à.

## üõ°Ô∏è –ü—Ä–∏–Ω—Ü–∏–ø–∏

- **SRP:** —Ç—ñ–ª—å–∫–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è HTML; –∂–æ–¥–Ω–æ—ó –ª–æ–≥—ñ–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥—É.
- **Async-safe:** –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ locks –≤–µ–¥—É—Ç—å—Å—è –ø—ñ–¥ `asyncio.Lock`.
- **Singleton:** –æ–¥–Ω–∞ –ø—Ä–æ—Ü–µ—Å–Ω–∞ —ñ–Ω—Å—Ç–∞–Ω—Ü—ñ—è –¥–ª—è —Å–ø—ñ–ª—å–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.
- **–ë–µ–∑ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏—Ö –º—É—Ç–∞—Ü—ñ–π:** `OrderedDict` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —É –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–º—É `_LRU`.

## ‚ö†Ô∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

- `max_entries`: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ (–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 256).
- `ttl_sec`: —á–∞—Å –∂–∏—Ç—Ç—è –∑–∞–ø–∏—Å—É –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 300).
- `key_lock(key)`: —Å–ª—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è ¬´thundering herd¬ª.

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –ø—ñ—Å–ª—è TTL.
- –ì–∞—Ä–∞–Ω—Ç—ñ—è, —â–æ `set()` –Ω–µ –ø–µ—Ä–µ–≤–∏—â—É—î –ª—ñ–º—ñ—Ç LRU.
- –Ü–º—ñ—Ç–∞—Ü—ñ—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏—Ö `key_lock` –∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏.
