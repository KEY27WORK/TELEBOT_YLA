# üì¨ app/infrastructure/availability/availability_i18n.py
"""
üì¨ –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π i18n-—à–∞—Ä –¥–ª—è Availability-—Ñ–ª–æ—É.

üîπ –ó–±–µ—Ä—ñ–≥–∞—î –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫–ª—é—á–æ–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫.
üîπ –ù–∞–¥–∞—î `t()` –¥–ª—è –≤–∏–±—ñ—Ä–∫–∏ —Ç–µ–∫—Å—Ç—ñ–≤ –∑ fallback –Ω–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫—É.
üîπ –ù–æ—Ä–º–∞–ª—ñ–∑—É—î —Å–∏—Ä—ñ `language_code` –≤—ñ–¥ Telegram —á–µ—Ä–µ–∑ `normalize_lang()`.
"""

from __future__ import annotations

# üåê –ó–æ–≤–Ω—ñ—à–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏
# (–Ω–µ–º–∞—î –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π)										# üö´ –õ–∏—à–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
import logging														# üßæ –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑–≤–µ—Ä–Ω–µ–Ω—å –¥–æ —Å–ª–æ–≤–Ω–∏–∫–∞
from typing import Dict												# üìê –¢–∏–ø—ñ–∑–∞—Ü—ñ—è —Å–ª–æ–≤–Ω–∏–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ –ø—Ä–æ—î–∫—Ç—É
from app.shared.utils.logger import LOG_NAME						# üè∑Ô∏è –Ñ–¥–∏–Ω–µ —ñ–º º—è –ª–æ–≥–µ—Ä–∞


# ================================
# üßæ –õ–û–ì–ï–†
# ================================
logger = logging.getLogger(LOG_NAME)								# üßæ –õ–æ–∫–∞–ª—å–Ω–∏–π –ª–æ–≥–µ—Ä i18n-–º–æ–¥—É–ª—è


# ================================
# üåç –°–õ–û–í–ù–ò–ö –ü–û–í–Ü–î–û–ú–õ–ï–ù–¨
# ================================
MESSAGES: Dict[str, Dict[str, str]] = {
    "uk": {															# üá∫üá¶ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é
        "empty_url": "‚ö†Ô∏è –ü–æ—Å–∏–ª–∞–Ω–Ω—è –ø–æ—Ä–æ–∂–Ω—î. –ù–∞–¥—ñ—à–ª–∏ –∫–æ—Ä–µ–∫—Ç–Ω–∏–π URL —Ç–æ–≤–∞—Ä—É.",  # üîë –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –¥–ª—è –ø—É—Å—Ç–æ–≥–æ URL
        "process_failed": "‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è –æ–±—Ä–æ–±–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–æ–≤–∞—Ä.",	# üîß –ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏
        "send_failed": "‚ùå –°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É. –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑ –ø—ñ–∑–Ω—ñ—à–µ.",  # üì§ –§–µ–π–ª –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è
    },
    "ru": {															# üá∑üá∫ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ä–æ—Å—ñ–π—Å—å–∫–æ—é
        "empty_url": "‚ö†Ô∏è –°—Å—ã–ª–∫–∞ –ø—É—Å—Ç–∞. –ü—Ä–∏—à–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL —Ç–æ–≤–∞—Ä–∞.",	# üîë –ü–æ—Ä–æ–∂–Ω—ñ–π URL
        "process_failed": "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä.",	# üîß –ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏
        "send_failed": "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.",  # üì§ –§–µ–π–ª –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è
    },
    "en": {															# üá¨üáß –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é
        "empty_url": "‚ö†Ô∏è URL is empty. Please send a valid product link.",	# üîë –ü–æ—Ä–æ–∂–Ω—ñ–π URL
        "process_failed": "‚ö†Ô∏è Failed to process the product link.",		# üîß –ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏
        "send_failed": "‚ùå An error occurred while sending the result. Please try again later.",  # üì§ –§–µ–π–ª –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è
    },
}																	# üì¶ –ü–æ–≤–Ω–∏–π –Ω–∞–±—ñ—Ä –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

_SUPPORTED = set(MESSAGES.keys())									# ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ñ –ª–æ–∫–∞–ª—ñ


# ================================
# üí¨ –î–û–°–¢–£–ü –î–û I18N
# ================================
def t(key: str, lang: str = "uk") -> str:
    """
    üí¨ –ü–æ–≤–µ—Ä—Ç–∞—î –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞ –∫–ª—é—á–µ–º.

    Args:
        key: –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
        lang: –ë–∞–∂–∞–Ω–∞ –ª–æ–∫–∞–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (fallback ‚Üí "uk").
    """
    lang_code = lang if lang in _SUPPORTED else "uk"					# üåç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –ª–æ–∫–∞–ª—ñ
    pack = MESSAGES.get(lang_code, MESSAGES["uk"])					# üì¶ –û–±–∏—Ä–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π —Å–ª–æ–≤–Ω–∏–∫
    value = pack.get(key, key)										# üßæ –î—ñ—Å—Ç–∞—î–º–æ —Ç–µ–∫—Å—Ç –∞–±–æ –∫–ª—é—á
    logger.debug(													# ü™µ –õ–æ–≥—É—î–º–æ —Ñ–∞–∫—Ç –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è
        "üí¨ availability.i18n_lookup",
        extra={"key": key, "lang": lang, "resolved_lang": lang_code},
    )
    return value													# üì§ –í—ñ–¥–¥–∞—î–º–æ –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç


def normalize_lang(code: str | None, default: str = "uk") -> str:
    """
    üîÑ –ù–æ—Ä–º–∞–ª—ñ–∑—É—î `language_code` –∑ Telegram –¥–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–æ–≥–æ —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è.

    Args:
        code: –ó–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ –∫—à—Ç–∞–ª—Ç "uk-UA" –∞–±–æ "ru".
        default: –õ–æ–∫–∞–ª—å –∑–∞ –ø—Ä–æ–º–æ–≤—á–∞–Ω–Ω—è–º, —è–∫—â–æ –∫–æ–¥ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è.
    """
    if not code:													# üö´ –í—ñ–¥—Å—É—Ç–Ω—ñ–π –∫–æ–¥ –ª–æ–∫–∞–ª—ñ
        logger.debug(
            "‚ö†Ô∏è availability.lang_empty",
            extra={"default": default},
        )															# ü™µ –í–∫–∞–∑—É—î–º–æ fallback
        return default												# ‚Ü©Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –¥–µ—Ñ–æ–ª—Ç
    normalized = code.strip().lower()[:2]							# ‚úÇÔ∏è –ë–µ—Ä–µ–º–æ –ø–µ—Ä—à—ñ –¥–≤–∞ —Å–∏–º–≤–æ–ª–∏
    resolved = normalized if normalized in _SUPPORTED else default	# üß† –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—ñ–¥—Ç—Ä–∏–º–∫—É
    logger.debug(
        "üåê availability.lang_normalized",
        extra={"raw": code, "normalized": normalized, "resolved": resolved},
    )																# ü™µ –§—ñ–∫—Å—É—î–º–æ –≤–∏–±—Ä–∞–Ω—É –ª–æ–∫–∞–ª—å
    return resolved													# üì§ –í—ñ–¥–¥–∞—î–º–æ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –∫–æ–¥


__all__ = ["t", "normalize_lang"]									# üì¶ –ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–∏–π API –º–æ–¥—É–ª—è
