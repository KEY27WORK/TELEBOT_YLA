# üß† –ú–æ–¥—É–ª—å: –ü–∞—Ä—Å–µ—Ä–∏ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤

–ú–æ–¥—É–ª—å –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ **–ø–æ–≤–Ω—É –ª–æ–≥—ñ–∫—É –ø–∞—Ä—Å–∏–Ω–≥—É** —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤, –∫–æ–ª–µ–∫—Ü—ñ–π —ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–æ—à—É–∫—É –Ω–∞ —Å–∞–π—Ç—ñ YoungLA.

## üîç –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è HTML-—Å—Ç–æ—Ä—ñ–Ω–æ–∫ —ñ –≤–∏—Ç—è–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö (–Ω–∞–∑–≤–∞, –æ–ø–∏—Å, —Ü—ñ–Ω–∞, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Ç–æ—â–æ).
- –ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—ñ–≤ –∑–∞ –∞—Ä—Ç–∏–∫—É–ª–æ–º –∞–±–æ –Ω–∞–∑–≤–æ—é (UI‚Äë–ø–æ—à—É–∫).
- –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –æ–±—Ä–æ–±–∫–∏ —É –≤–µ—Ä—Ö–Ω—ñ—Ö —à–∞—Ä–∞—Ö (—á–µ—Ä–µ–∑ `IProductDataProvider`, `ICollectionLinksProvider`).

## üì¶ –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### `base_parser.py` ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
- –ü–æ–≤–Ω–∏–π —Ü–∏–∫–ª –æ–±—Ä–æ–±–∫–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Ç–æ–≤–∞—Ä—É (fetch ‚Üí extract ‚Üí process ‚Üí validate).
- –î–µ–ª–µ–≥—É—î –≤–∏—Ç—è–≥ –¥–∞–Ω–∏—Ö —É `HtmlDataExtractor`.
- –ü—Ä–∏–π–º–∞—î —Ä—ñ—à–µ–Ω–Ω—è —â–æ–¥–æ fallback‚Äë–ª–æ–≥—ñ–∫–∏ (–æ–ø–∏—Å, stock, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è).

### `html_data_extractor.py` ‚Äî –µ–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä –¥–∞–Ω–∏—Ö
- –ù–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–∞ —É—Ç–∏–ª—ñ—Ç–∞, —â–æ –≤–º—ñ—î **–≤–∏—Ç—è–≥—É–≤–∞—Ç–∏** –¥–∞–Ω—ñ –∑ DOM/JSON‚ÄëLD/legacy Shopify.
- **–ù–µ –º—ñ—Å—Ç–∏—Ç—å –ª–æ–≥—ñ–∫–∏ –≤–∏–±–æ—Ä—É –¥–∂–µ—Ä–µ–ª–∞** ‚Äî —Ü–µ —Ä–æ–±–∏—Ç—å `BaseParser`.

### `parser_factory.py` ‚Äî —Ñ–∞–±—Ä–∏–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
- –°—Ç–≤–æ—Ä—é—î —ñ–Ω—Å—Ç–∞–Ω—Å–∏ –ø–∞—Ä—Å–µ—Ä—ñ–≤ (`BaseParser`, `UniversalCollectionParser`, `ProductSearchResolver`).
- –Ü–Ω‚Äô—î–∫—Ç—É—î –∑–∞–≥–∞–ª—å–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏ (`WebDriverService`, `TranslatorService`, `WeightResolver`, `UrlParserService`, `ConfigService`).
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —î–¥–∏–Ω—ñ —ñ–Ω—Ñ—Ä–∞‚Äë–æ–ø—Ü—ñ—ó `ParserInfraOptions` (–¥–∏–≤. `_infra_options.py`).

### `factory_adapter.py` ‚Äî –∞–¥–∞–ø—Ç–µ—Ä —Ñ–∞–±—Ä–∏–∫–∏
- –û–±–≥–æ—Ä—Ç–∞—î —Ä–µ–∞–ª—å–Ω—ñ INFRA‚Äë–ø–∞—Ä—Å–µ—Ä–∏ –≤ **–¥–æ–º–µ–Ω–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏** (`IProductDataProvider`, `ICollectionLinksProvider`).
- –ù–æ—Ä–º–∞–ª—ñ–∑—É—î –ª—ñ–Ω–∫–∏ —ñ –≥–∞—Ä–∞–Ω—Ç—É—î —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑—ñ strict‚Äëtyping –¥–æ–º–µ–Ω—É.

### `collections/universal_collection_parser.py`
- –ü–∞—Ä—Å–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∫–æ–ª–µ–∫—Ü—ñ–π (`/collections/...`).
- JSON‚ÄëLD ‚Üí DOM‚Äëfallback ‚Üí –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è ‚Üí —É–Ω—ñ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è `/products/...` –ø–æ—Å–∏–ª–∞–Ω—å.

### `product_search/search_resolver.py`
- –†–µ–∞–ª—ñ–∑—É—î UI‚Äë–ø–æ—à—É–∫ YoungLA —á–µ—Ä–µ–∑ Playwright.
- –ü–æ–≤–µ—Ä—Ç–∞—î –ø–µ—Ä—à–∏–π/–∫—ñ–ª—å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤ (`Url`/`SearchResult`).

# üß∞ –ú–æ–¥—É–ª—å `parsers`

–ú–æ–¥—É–ª—å **parsers** –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ñ –ø–∞—Ä—Å–µ—Ä–∏ —Ç–∞ —Ñ–∞–±—Ä–∏–∫–∏ YoungLA: –ø–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä—ñ–≤, –∫–æ–ª–µ–∫—Ü—ñ–π, –ø–æ—à—É–∫—É, –∞ —Ç–∞–∫–æ–∂ —ñ–Ω—Ñ—Ä–∞-–æ–ø—Ü—ñ—ó –π –∞–¥–∞–ø—Ç–µ—Ä–∏ –ø—ñ–¥ –¥–æ–º–µ–Ω–Ω—ñ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```bash
üì¶ parsers/
‚îú‚îÄ‚îÄ üìò README.md            # (—Ü–µ–π —Ñ–∞–π–ª) –ø—É—Ç—ñ–≤–Ω–∏–∫ –ø–æ –ø–∞–∫–µ—Ç—É
‚îú‚îÄ‚îÄ üìÑ __init__.py          # –µ–∫—Å–ø–æ—Ä—Ç –±–∞–∑–æ–≤–∏—Ö –ø–∞—Ä—Å–µ—Ä—ñ–≤/—Ñ–∞–±—Ä–∏–∫
‚îú‚îÄ‚îÄ üìÑ _infra_options.py    # –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏—Ö –æ–ø—Ü—ñ–π
‚îú‚îÄ‚îÄ üìÑ base_parser.py       # —è–¥—Ä–æ –ø–∞—Ä—Å–µ—Ä–∞ —Ç–æ–≤–∞—Ä—É
‚îú‚îÄ‚îÄ üìÑ contracts.py         # –ø—Ä–æ—Ç–æ–∫–æ–ª–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏—Ö –ø–∞—Ä—Å–µ—Ä—ñ–≤
‚îú‚îÄ‚îÄ üìÑ factory_adapter.py   # –∞–¥–∞–ø—Ç–µ—Ä —É –¥–æ–º–µ–Ω–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏
‚îú‚îÄ‚îÄ üìÑ html_data_extractor.py
‚îú‚îÄ‚îÄ üìÑ parser_factory.py    # —Ñ–∞–±—Ä–∏–∫–∞ –ø–∞—Ä—Å–µ—Ä—ñ–≤
‚îú‚îÄ‚îÄ üìÇ collections/
‚îÇ   ‚îú‚îÄ‚îÄ üìò README.md
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ universal_collection_parser.py
‚îú‚îÄ‚îÄ üìÇ extractors/
‚îÇ   ‚îú‚îÄ‚îÄ üìò README.md        # (—è–∫—â–æ –±—É–¥–µ)
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ base.py
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ description.py
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ images.py
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ json_ld.py
‚îî‚îÄ‚îÄ üìÇ product_search/
    ‚îú‚îÄ‚îÄ üìò README.md
    ‚îú‚îÄ‚îÄ üìÑ __init__.py
    ‚îî‚îÄ‚îÄ üìÑ search_resolver.py
```

---
## ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø–∏

- SOLID, DI: —É—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏.
- –†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –æ–±–æ–≤‚Äô—è–∑–∫—ñ–≤: –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (`BaseParser`) vs –µ–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä (`HtmlDataExtractor`).
- –ú—ñ–Ω—ñ–º—É–º –∑–≤‚Äô—è–∑–Ω–æ—Å—Ç—ñ –º—ñ–∂ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, —á–∏—Å—Ç—ñ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏ –¥–ª—è –¥–æ–º–µ–Ω—É.
- –Ñ–¥–∏–Ω—ñ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ñ –æ–ø—Ü—ñ—ó `ParserInfraOptions` (–ª–æ–≥—É–≤–∞–Ω–Ω—è, —Ç–∞–π–º–∞—É—Ç–∏, HTML‚Äë–ø–∞—Ä—Å–µ—Ä, –ª—ñ–º—ñ—Ç–∏).
- –ì–Ω—É—á–∫–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Telegram‚Äë–±–æ—Ç–æ–º —á–µ—Ä–µ–∑ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ `IProductDataProvider` —Ç–∞ `ICollectionLinksProvider`.

## ParserInfraOptions –∏ ENV

`ParserInfraOptions` ‚Äî –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –æ–ø—Ü–∏–π –¥–ª—è –ø–∞—Ä—Å–µ—Ä–æ–≤.  
–ó–Ω–∞—á–µ–Ω–∏—è —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ ENV –ø–æ *–ø—Ä–µ—Ñ–∏–∫—Å—É* (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `PARSER_`). –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä `YLA_PARSER_`.

### –°–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–¥–ª—è –ª—é–±–æ–≥–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞)

- `${PREFIX}HTML_PARSER` ‚Äî `lxml` | `html.parser` | `html5lib`
- `${PREFIX}ENABLE_PROGRESS` ‚Äî bool (`1/0`, `true/false`, `yes/no`, ‚Ä¶)
- `${PREFIX}REQUEST_TIMEOUT_SEC` ‚Äî int > 0
- `${PREFIX}RETRY_ATTEMPTS` ‚Äî int ‚â• 0
- `${PREFIX}RETRY_BACKOFF_SEC` ‚Äî float > 0
- `${PREFIX}MIN_HTML_BYTES` ‚Äî int ‚â• 0
- `${PREFIX}IMAGES_LIMIT` ‚Äî 1..200
- `${PREFIX}FILTER_SMALL_IMAGES` ‚Äî bool
- `${PREFIX}LOG_LEVEL` ‚Äî `CRITICAL|ERROR|WARNING|INFO|DEBUG`
- `${PREFIX}USER_AGENT` ‚Äî str
- `${PREFIX}LOCALE` ‚Äî str (–Ω–∞–ø—Ä., `en-US`)

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

```python
from app.infrastructure.parsers._infra_options import ParserInfraOptions

opts = ParserInfraOptions.from_env_autodetect()

# –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å: PARSER_
opts = ParserInfraOptions.from_env_autodetect()

# –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å: YLA_PARSER_
opts_yla = ParserInfraOptions.from_env(prefix="YLA_PARSER_")

# –°–º–µ—à–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º YLA_PARSER_, –ø–æ—Ç–æ–º PARSER_
def from_env_autodetect() -> ParserInfraOptions:
    try_first = ("YLA_PARSER_", "PARSER_")
    for p in try_first:
        opts = ParserInfraOptions.from_env(prefix=p)
        if opts != ParserInfraOptions.default():  # –ø—Ä–æ—Å—Ç–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞: —á—Ç–æ-—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–ª–æ—Å—å
            return opts
    return ParserInfraOptions.from_env()  # –¥–µ—Ñ–æ–ª—Ç—ã

```

### ENV-–∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –¥–µ—Ñ–æ–ª—Ç—ã. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –≤ –ø–æ–ª—å–∑—É –¥–µ—Ñ–æ–ª—Ç–æ–≤ (–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –≤ __post_init__).

## Image filters (IMP-018)
–ö–æ–Ω—Ñ–∏–≥: `parser.images`
- `allowed_ext`: –¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é [".jpg",".jpeg",".png",".webp",".avif"])
- `bad_tokens`: —Ç–æ–∫–µ–Ω—ã-–º—É—Å–æ—Ä (favicon, sprite, ‚Ä¶)
- `min_side_px`: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –º–∏–Ω–∏–∞—Ç—é—Ä, –∏–∑–≤–ª–µ–∫–∞–µ–º–∞—è –∏–∑ URL-–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (_80x, _80x80, /w80/, /width_80/)
