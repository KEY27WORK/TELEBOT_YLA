# üì¶ app/infrastructure/size_chart/dto.py
"""
üì¶ DTO –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ OCR —Ç–∞–±–ª–∏—Ü—å —Ä–æ–∑–º—ñ—Ä—ñ–≤.

üîπ –§—ñ–∫—Å—É—î–º–æ —Å—Ç–∞—Ç—É—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ.
üîπ –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å–∏—Ä–∏–π —Ç–µ–∫—Å—Ç –¥–ª—è –¥–µ–±–∞–≥—É —Ç–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å –ø–æ–º–∏–ª–∫–∏.
üîπ –ù–∞–¥–∞—î–º–æ –∑—Ä—É—á–Ω–∏–π –ø—Ä–∞–ø–æ—Ä `ok` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —É—Å–ø—ñ—Ö—É –ø–∞–π–ø–ª–∞–π–Ω–∞.
"""

from __future__ import annotations

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
from dataclasses import dataclass											# üß± –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö
from enum import Enum														# üè∑Ô∏è –ü–µ—Ä–µ–ª—ñ–∫ —Å—Ç–∞—Ç—É—Å—ñ–≤
from typing import Any, Dict, Optional										# üß∞ –£–∑–≥–æ–¥–∂–µ–Ω–∞ —Ç–∏–ø—ñ–∑–∞—Ü—ñ—è


# ================================
# üè∑Ô∏è –°–¢–ê–¢–£–°–ò OCR
# ================================
class SizeChartOcrStatus(str, Enum):
    """üè∑Ô∏è –ú–æ–∂–ª–∏–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–æ–±–æ—Ç–∏ OCR."""

    OK = "ok"																# ‚úÖ –†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–µ
    TIMEOUT = "timeout"													# ‚è≥ –ü–µ—Ä–µ–≤–∏—â–µ–Ω–æ —Ç–∞–π–º–∞—É—Ç –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
    INVALID_JSON = "invalid_json"											# üìÑ –ü–æ–≤–µ—Ä–Ω—É—Ç–æ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π JSON
    API_ERROR = "api_error"												# üì° –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥ —Å–µ—Ä–≤—ñ—Å—É OpenAI
    IO_ERROR = "io_error"													# üíΩ –ù–µ –≤–¥–∞–ª–æ—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –∞–±–æ –∑–∞–ø–∏—Å–∞—Ç–∏ —Ñ–∞–π–ª
    EMPTY = "empty"														# üö´ –í—ñ–¥–ø–æ–≤—ñ–¥—å –ø–æ—Ä–æ–∂–Ω—è


# ================================
# üìä DTO –†–ï–ó–£–õ–¨–¢–ê–¢–£
# ================================
@dataclass
class SizeChartOcrResult:
    """
    üìä –†–µ–∑—É–ª—å—Ç–∞—Ç OCR —Ä–∞–∑–æ–º —ñ–∑ –¥–æ–ø–æ–º—ñ–∂–Ω–∏–º–∏ –ø–æ–ª—è–º–∏ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É.

    Attributes:
        status (SizeChartOcrStatus): –ü—ñ–¥—Å—É–º–∫–æ–≤–∏–π —Å—Ç–∞–Ω –æ–±—Ä–æ–±–∫–∏.
        data (dict[str, Any] | None): –ù–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ.
        raw_text (str | None): –°–∏—Ä–∏–π —Ç–µ–∫—Å—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–¥–ª—è –≤—ñ–¥–ª–∞–¥–∫–∏).
        error (str | None): –ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å –ø–æ–º–∏–ª–∫–∏ –¥–ª—è –ª–æ–≥—ñ–≤.
    """

    status: SizeChartOcrStatus											# üè∑Ô∏è –§—ñ–∫—Å—É—î–º–æ –ø—ñ–¥—Å—É–º–∫–æ–≤–∏–π —Å—Ç–∞—Ç—É—Å
    data: Optional[Dict[str, Any]] = None								# üìä –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü—è –∑ OCR
    raw_text: Optional[str] = None										# üìù –°–∏—Ä–∏–π JSON –∞–±–æ —Ç–µ–∫—Å—Ç
    error: Optional[str] = None											# ‚ùå –ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å –∑–±–æ—é

    @property
    def ok(self) -> bool:
        """‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —â–æ OCR –ø—Ä–æ–π—à–æ–≤ —É—Å–ø—ñ—à–Ω–æ —ñ –¥–∞–Ω—ñ –Ω–µ–ø–æ—Ä–æ–∂–Ω—ñ."""
        return (
            self.status == SizeChartOcrStatus.OK							# üü¢ –ú–∞—î–º–æ —Å—Ç–∞—Ç—É—Å OK
            and isinstance(self.data, dict)								# üìê –î–∞–Ω—ñ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ñ —Å–ª–æ–≤–Ω–∏–∫–æ–º
            and bool(self.data)											# üì¶ –Ñ —Ö–æ—á–∞ –± –æ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç
        )


__all__ = ["SizeChartOcrStatus", "SizeChartOcrResult"]					# üì¶ –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ DTO
