# üåç app/shared/utils/locale.py
"""
üåç –•–µ–ª–ø–µ—Ä–∏ –¥–ª—è –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó –º–æ–≤–Ω–∏—Ö –∫–æ–¥—ñ–≤ —É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.

üîπ –°–∫–æ—Ä–æ—á—É—î —Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω—ñ —Å—É—Ñ—ñ–∫—Å–∏ (`"en-US"` ‚Üí `"en"`).
üîπ –ü—ñ–¥—Ç—Ä–∏–º—É—î fallback-–∏ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∏—Ö –º–æ–≤ (`uk`, `en`).
üîπ –£–∑–≥–æ–¥–∂—É—î –∫–æ–¥–∏ Telegram –∑ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ—é –ª–æ–∫–∞–ª–ª—é.
"""

from __future__ import annotations

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
from typing import Optional  # üß∞ –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ç–∏–ø–∏ –¥–ª—è nullable –∑–Ω–∞—á–µ–Ω—å

# ================================
# üßæ –ü–£–ë–õ–Ü–ß–ù–ò–ô –Ü–ù–¢–ï–†–§–ï–ô–° –ú–û–î–£–õ–Ø
# ================================
__all__ = ["normalize_locale", "lang_from_telegram_code"]

# ================================
# üìö –ö–û–ù–°–¢–ê–ù–¢–ò
# ================================
_SUPPORTED = {"uk", "en"}  # ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –ª–æ–∫–∞–ª—ñ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É
_TG_MAP = {
    "uk": "uk",   # üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞
    "en": "en",   # üá¨üáß –ê–Ω–≥–ª—ñ–π—Å—å–∫–∞
    "en-us": "en",  # üá∫üá∏ –†–µ–≥—ñ–æ–Ω–∞–ª—å–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ ‚Üí en
    "en-gb": "en",  # üá¨üáß –†–µ–≥—ñ–æ–Ω–∞–ª—å–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ ‚Üí en
}


# ================================
# üßÆ –ù–û–†–ú–ê–õ–Ü–ó–ê–¶–Ü–Ø –õ–û–ö–ê–õ–Ü
# ================================
def normalize_locale(value: Optional[str], default: str = "uk") -> str:
    """–ü–æ–≤–µ—Ä—Ç–∞—î –ª–æ–∫–∞–ª—å –∑—ñ —Å–ø–∏—Å–∫—É –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∏—Ö, —ñ–Ω–∞–∫—à–µ fallback."""
    sanitized = (value or "").strip().lower()  # ‚úÇÔ∏è –û—á–∏—â–∞—î–º–æ –≤—Ö—ñ–¥–Ω–∏–π –∫–æ–¥
    if not sanitized:                          # üõë –ù–µ–º–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è
        return default
    base = sanitized.split("-", 1)[0]          # üî° ¬´en-us¬ª ‚Üí ¬´en¬ª
    if base in _SUPPORTED:                     # ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∞ –ª–æ–∫–∞–ª—å
        return base
    return default                             # üîÅ –§–æ–ª–±–µ–∫ –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—É –º–æ–≤—É


# ================================
# ‚úàÔ∏è –ö–û–î–ò TELEGRAM ‚Üí –õ–û–ö–ê–õ–Ü
# ================================
def lang_from_telegram_code(code: Optional[str], default: str = "uk") -> str:
    """–ú–∞–ø–∏—Ç—å Telegram language_code –Ω–∞ –ª–æ–∫–∞–ª—å –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É."""
    sanitized = (code or "").strip().lower()           # ‚úÇÔ∏è –û—á–∏—â–∞—î–º–æ –∫–æ–¥ –∑ Telegram
    if not sanitized:                                  # üõë –í—ñ–¥—Å—É—Ç–Ω—ñ–π –∫–æ–¥
        return default
    return _TG_MAP.get(sanitized, normalize_locale(sanitized, default))  # üîÅ –ü—Ä–æ–±—É—î–º–æ —É —Å–ª–æ–≤–Ω–∏–∫—É, —ñ–Ω–∞–∫—à–µ –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ
