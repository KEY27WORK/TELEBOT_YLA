# üöª app/infrastructure/content/gender_classifier.py
"""
üöª gender_classifier.py ‚Äî —Å–µ—Ä–≤—ñ—Å –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≥–µ–Ω–¥–µ—Ä—É –∑–∞ –∞—Ä—Ç–∏–∫—É–ª–æ–º —Ç–æ–≤–∞—Ä—É.
"""

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
import logging                                                               # üßæ –õ–æ–≥—É–≤–∞–Ω–Ω—è
from typing import List, Dict                                                # üß∞ –¢–∏–ø—ñ–∑–∞—Ü—ñ—è

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ
from app.shared.utils.logger import LOG_NAME                                # üìõ –ù–∞–∑–≤–∞ –ª–æ–≥–µ—Ä–∞ –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

logger = logging.getLogger(LOG_NAME)                                        # üßæ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ª–æ–≥–µ—Ä–∞

# ================================
# üèõÔ∏è –ö–õ–ê–° –ö–õ–ê–°–ò–§–Ü–ö–ê–¢–û–†–ê –ì–ï–ù–î–ï–†–£
# ================================
class GenderClassifier:
    """
    üöª –í–∏–∑–Ω–∞—á–∞—î –≥–µ–Ω–¥–µ—Ä–Ω—ñ —Ö–µ—à—Ç–µ–≥–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø—Ä–µ—Ñ—ñ–∫—Å–∞ –∞—Ä—Ç–∏–∫—É–ª–∞ —Ç–æ–≤–∞—Ä—É,
    –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø—Ä–∞–≤–∏–ª–∞ –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: 'W' ‚Üí –∂—ñ–Ω–∫–∏).
    """

    def __init__(self, gender_rules: Dict[str, List[str]]):
        """
        ‚öôÔ∏è –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–µ—Ä–≤—ñ—Å—É –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∑—ñ —Å–ª–æ–≤–Ω–∏–∫–∞.

        Args:
            gender_rules (dict): üìã –°–ª–æ–≤–Ω–∏–∫, –¥–µ –∫–ª—é—á ‚Äî –ø—Ä–µ—Ñ—ñ–∫—Å, –∞ –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äî —Å–ø–∏—Å–æ–∫ —Ö–µ—à—Ç–µ–≥—ñ–≤.
        """
        self.gender_rules = gender_rules                                       # üìã –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª —É –≤–∏–≥–ª—è–¥—ñ {–ø—Ä–µ—Ñ—ñ–∫—Å: [—Ç–µ–≥–∏]}

    def classify(self, article: str) -> List[str]:
        """
        üß¨ –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –≥–µ–Ω–¥–µ—Ä–Ω–∏—Ö —Ö–µ—à—Ç–µ–≥—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–¥–∞–Ω–æ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–∞.

        Args:
            article (str): üî§ –ê—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "W130")

        Returns:
            List[str]: üìé –ü–µ—Ä–µ–ª—ñ–∫ —Ö–µ—à—Ç–µ–≥—ñ–≤ –∑–∞ –≥–µ–Ω–¥–µ—Ä–Ω–æ—é –æ–∑–Ω–∞–∫–æ—é.
        """
        for prefix, tags in self.gender_rules.items():
            if prefix != "default" and article.startswith(prefix):                      # üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –∞—Ä—Ç–∏–∫—É–ª –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ –ø–µ–≤–Ω–æ–≥–æ –ø—Ä–µ—Ñ—ñ–∫—Å—É
                logger.info(f"üöª –ó–Ω–∞–π–¥–µ–Ω–æ –≥–µ–Ω–¥–µ—Ä–Ω—ñ —Ö–µ—à—Ç–µ–≥–∏ –∑–∞ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º '{prefix}'")   # üßæ –õ–æ–≥ ‚Äî –∑–Ω–∞–π–¥–µ–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å
                return tags                                                              # ‚úÖ –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–Ω–∞–π–¥–µ–Ω—ñ —Ç–µ–≥–∏

        logger.info("üë®‚Äçü¶± –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è fallback ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —á–æ–ª–æ–≤—ñ—á—ñ —Ö–µ—à—Ç–µ–≥–∏.")     # ‚ÑπÔ∏è Fallback —É —Ä–∞–∑—ñ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –ø—Ä–µ—Ñ—ñ–∫—Å—É
        return self.gender_rules.get("default", [])                                     # ‚õî –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ default-—Å–ø–∏—Å–æ–∫