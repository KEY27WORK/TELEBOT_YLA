# üíæ app/infrastructure/availability/cache_service.py
"""
üíæ cache_service.py ‚Äî –°–µ—Ä–≤—ñ—Å in-memory –∫–µ—à—É–≤–∞–Ω–Ω—è.

üîπ –ö–ª–∞—Å `AvailabilityCacheService`:
- –ö–µ—à—É—î –±—É–¥—å-—è–∫—ñ –¥–∞–Ω—ñ –∑–∞ –∫–ª—é—á–µ–º –Ω–∞ –ø–µ–≤–Ω–∏–π —á–∞—Å (TTL).
- –ü—Ä–∞—Ü—é—î —É –ø–∞–º º—è—Ç—ñ (in-memory).
"""

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
import time                                                        # ‚è±Ô∏è –ü–æ—Ç–æ—á–Ω–∏–π —á–∞—Å –¥–ª—è TTL
from typing import Any, Dict                                       # üß∞ –¢–∏–ø—ñ–∑–∞—Ü—ñ—è –¥–ª—è —Å–ª–æ–≤–Ω–∏–∫—ñ–≤ —ñ –∑–Ω–∞—á–µ–Ω—å


# ================================
# üíæ –ö–õ–ê–° –°–ï–†–í–Ü–°–£ –ö–ï–®–£–í–ê–ù–ù–Ø
# ================================
class AvailabilityCacheService:
    """
    üìä –°–µ—Ä–≤—ñ—Å –∫–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ç–æ–≤–∞—Ä—É.

    ‚úÖ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:
    - –¢–∏–º—á–∞—Å–æ–≤–æ –∑–±–µ—Ä—ñ–≥–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ –∫–ª—é—á—É (—à–ª—è—Ö—É –¥–æ —Ç–æ–≤–∞—Ä—É).
    - –ü–æ–≤–µ—Ä—Ç–∞—î –¥–∞–Ω—ñ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –≤–æ–Ω–∏ —â–µ –∞–∫—Ç—É–∞–ª—å–Ω—ñ (TTL –Ω–µ –≤–∏—á–µ—Ä–ø–∞–Ω–æ).
    """

    def __init__(self):
        """
        üèÅ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π in-memory –∫–µ—à.
        """
        self._cache: Dict[str, Dict[str, Any]] = {}                             # üß† –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –∫–ª—é—á ‚Üí {data, time}

    # ================================
    # üß™ –û–¢–†–ò–ú–ê–ù–ù–Ø –î–ê–ù–ò–• –ó –ö–ï–®–£
    # ================================
    def get(self, key: str, ttl: int) -> Any | None:
        """
        üß™ –û—Ç—Ä–∏–º—É—î –∫–µ—à–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ, —è–∫—â–æ –≤–æ–Ω–∏ —â–µ –Ω–µ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ.

        Args:
            key (str): üîë –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–ª—é—á –∫–µ—à—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —à–ª—è—Ö –¥–æ —Ç–æ–≤–∞—Ä—É).
            ttl (int): ‚è≥ –ß–∞—Å –∂–∏—Ç—Ç—è –∫–µ—à—É –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.

        Returns:
            Any | None: üì¶ –î–∞–Ω—ñ –∞–±–æ None, —è–∫—â–æ TTL –≤–∏—á–µ—Ä–ø–∞–Ω–æ –∞–±–æ –∫–ª—é—á –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.
        """
        cached_item = self._cache.get(key)                                              # üîç –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∑–∞ –∫–ª—é—á–µ–º
        if cached_item and time.time() - cached_item.get("time", 0) < ttl:            # ‚è±Ô∏è –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ TTL
            return cached_item.get("data")                                            # ‚úÖ –î–∞–Ω—ñ —â–µ –≤–∞–ª—ñ–¥–Ω—ñ
        return None                                                                     # ‚ùå –ù–µ–º–∞—î –∞–±–æ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–æ

    # ================================
    # üíæ –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø –î–ê–ù–ò–• –£ –ö–ï–®
    # ================================
    def set(self, key: str, data: Any) -> None:
        """
        üíæ –ó–±–µ—Ä—ñ–≥–∞—î –æ–±'—î–∫—Ç —É –∫–µ—à —ñ–∑ –ø–æ—Ç–æ—á–Ω–∏–º timestamp.

        Args:
            key (str): üîë –ö–ª—é—á –∫–µ—à—É.
            data (Any): üì¶ –î–∞–Ω—ñ, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∫–µ—à—É–≤–∞—Ç–∏.
        """
        self._cache[key] = {
            "data": data,                                                            # üì¶ –°–∞–º—ñ –¥–∞–Ω—ñ
            "time": time.time()                                                     # ‚è±Ô∏è –ß–∞—Å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
        }
