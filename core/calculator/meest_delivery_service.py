""" üì¶ meest_delivery_service.py ‚Äî –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π —Å–µ—Ä–≤—ñ—Å —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –¥–æ—Å—Ç–∞–≤–∫–∏ Meest –¥–ª—è –º—É–ª—å—Ç–∏-—Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏.

üîπ –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞:
- –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ç–∞—Ä–∏—Ñ—ñ–≤
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∫—Ä–∞—ó–Ω: –°–®–ê üá∫üá∏, –ë—Ä–∏—Ç–∞–Ω—ñ—è üá¨üáß, –ù—ñ–º–µ—á—á–∏–Ω–∞ üá©üá™, –ü–æ–ª—å—â–∞ üáµüá±
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ç–∏–ø—É –¥–æ—Å—Ç–∞–≤–∫–∏: –∞–≤—ñ–∞ ‚úàÔ∏è
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤

üîß –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î:
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π Python (–±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π)
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
"""

# üìö –Ü–º–ø–æ—Ä—Ç–∏
import logging
from typing import Optional


# === üöö Meest Delivery Service ===
class MeestDeliveryService:
    """üöö –ì–æ–ª–æ–≤–Ω–∏–π —Å–µ—Ä–≤—ñ—Å —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∞—Ä—Ç–æ—Å—Ç—ñ –¥–æ—Å—Ç–∞–≤–∫–∏ Meest."""

    # === üì¶ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ç–∞—Ä–∏—Ñ—ñ–≤ Meest ===

    PRICING = {
    
        # üá∫üá∏ –°–®–ê (USD)
        "us": {
            "air": lambda w: (
                5.90 if w <= 0.5                             # –¥–æ 0.5 –∫–≥: —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∞ —Ü—ñ–Ω–∞ $5.90
                else max(8.69 * w, 8.19)                     # –ø–æ–Ω–∞–¥ 0.5 –∫–≥: $8.69 –∑–∞ –∫–≥, –º—ñ–Ω—ñ–º—É–º $8.19
            )
        },
    
        # üá¨üáß –í–µ–ª–∏–∫–∞ –ë—Ä–∏—Ç–∞–Ω—ñ—è (GBP)
        "uk": {
            "air": lambda w: (
                8.05 + 1.45 * w if w <= 2                    # –¥–æ 2 –∫–≥: –±–∞–∑–æ–≤–∞ —Å—Ç–∞–≤–∫–∞ ¬£8.05 + ¬£1.45/–∫–≥
                else 5.15 + 2.55 * w if w <= 10              # 2‚Äì10 –∫–≥: ¬£5.15 + ¬£2.55/–∫–≥
                else 5.15 + 2.45 * w                         # –ø–æ–Ω–∞–¥ 10 –∫–≥: ¬£5.15 + ¬£2.45/–∫–≥
            )
        },
    
        # üá©üá™ –ù—ñ–º–µ—á—á–∏–Ω–∞ (EUR)
        "germany": {
            "air": lambda w: (
                5.00 if w <= 0.5                              # –¥–æ 0.5 –∫–≥: ‚Ç¨5.00
                else 9.50 if w <= 2.25                        # –¥–æ 2.25 –∫–≥: ‚Ç¨9.50
                else 4.50 * w if w <= 5                       # –¥–æ 5 –∫–≥: ‚Ç¨4.50/–∫–≥
                else 3.75 * w if w <= 10                      # –¥–æ 10 –∫–≥: ‚Ç¨3.75/–∫–≥
                else 3.50 * w if w <= 20                      # –¥–æ 20 –∫–≥: ‚Ç¨3.50/–∫–≥
                else 3.30 * w                                  # –ø–æ–Ω–∞–¥ 20 –∫–≥: ‚Ç¨3.30/–∫–≥
            )
        },
    
        # üáµüá± –ü–æ–ª—å—â–∞ (PLN)
        "poland": {
            "air": lambda w: (
                5.00 if w <= 0.5                              # –¥–æ 0.5 –∫–≥: 5 PLN
                else 7.50 if w <= 2.55                        # –¥–æ 2.55 –∫–≥: 7.50 PLN
                else 3.25 * w if w <= 5                       # –¥–æ 5 –∫–≥: 3.25 PLN/–∫–≥
                else 2.60 * w if w <= 10                      # –¥–æ 10 –∫–≥: 2.60 PLN/–∫–≥
                else 2.25 * w if w <= 20                      # –¥–æ 20 –∫–≥: 2.25 PLN/–∫–≥
                else 2.10 * w                                  # –ø–æ–Ω–∞–¥ 20 –∫–≥: 2.10 PLN/–∫–≥
            )
        }
    }


    @classmethod
    def get_price(
        cls,
        country: str,
        method: str,
        type_: str,
        weight_kg: float,
        volumetric_weight_kg: Optional[float] = None
    ) -> float:
        """üí∏ –û—Å–Ω–æ–≤–Ω–∏–π –º–µ—Ç–æ–¥ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∞—Ä—Ç–æ—Å—Ç—ñ –¥–æ—Å—Ç–∞–≤–∫–∏ Meest.

        üì• –í—Ö—ñ–¥–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:
        - country: –∫—Ä–∞—ó–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (us / uk / germany / poland)
        - method: –º–µ—Ç–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏ (air)
        - type_: —Ç–∏–ø –æ—Ç—Ä–∏–º–∞–Ω–Ω—è (courier)
        - weight_kg: —Ñ–∞–∫—Ç–∏—á–Ω–∞ –≤–∞–≥–∞ —É –∫—ñ–ª–æ–≥—Ä–∞–º–∞—Ö
        - volumetric_weight_kg: –æ–±'—î–º–Ω–∞ –≤–∞–≥–∞ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

        üì§ –ü–æ–≤–µ—Ä—Ç–∞—î:
        - –≤–∞—Ä—Ç—ñ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ —É –ª–æ–∫–∞–ª—å–Ω—ñ–π –≤–∞–ª—é—Ç—ñ –∫—Ä–∞—ó–Ω–∏
        """
        # üîΩ –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
        country = country.lower()
        method = method.lower()
        type_ = type_.lower()

        # üìù –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É
        logging.info(f"üì¶ Meest —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫: –∫—Ä–∞—ó–Ω–∞={country}, –º–µ—Ç–æ–¥={method}, —Ç–∏–ø={type_}, –≤–∞–≥–∞={weight_kg} –∫–≥")

        # üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
        if country not in cls.PRICING or method not in cls.PRICING[country]:
            logging.error(f"‚ùå –ù–µ–ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è: {country}, {method}")
            raise ValueError(f"‚ùå –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∞ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è: {country}, {method}")

        # üìä –û—Å–Ω–æ–≤–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —á–µ—Ä–µ–∑ –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü—ñ—é
        price = cls.PRICING[country][method](weight_kg)

        # üßæ –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        logging.debug(f"‚úÖ –û–±—Ä–∞—Ö–æ–≤–∞–Ω–æ —Ç–∞—Ä–∏—Ñ: {country.upper()} ({method}) ‚Üí {price:.2f}")

        return round(price, 2)
