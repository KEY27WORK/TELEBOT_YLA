# üßæ app/infrastructure/parsers/contracts.py
"""
üßæ –ö–æ–Ω—Ç—Ä–∞–∫—Ç–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏—Ö –ø–∞—Ä—Å–µ—Ä—ñ–≤ —Ç–∞ —Ñ–∞–±—Ä–∏–∫–∏.

üîπ –û–ø–∏—Å—É—é—Ç—å –º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏ ¬´—Å–∏—Ä–∏—Ö¬ª –ø–∞—Ä—Å–µ—Ä—ñ–≤ (–∫–æ–ª–µ–∫—Ü—ñ–π, —Ç–æ–≤–∞—Ä—ñ–≤, –ø–æ—à—É–∫—É).
üîπ –£—Ç—Ä–∏–º—É—é—Ç—å –¥–æ–º–µ–Ω –≤—ñ–¥ —Ü–∏–∫–ª—ñ—á–Ω–∏—Ö —ñ–º–ø–æ—Ä—Ç—ñ–≤ —á–µ—Ä–µ–∑ `TYPE_CHECKING`.
üîπ –ù–∞–¥–∞—é—Ç—å –¥–æ–º–µ–Ω–Ω–æ-—á–∏—Å—Ç–∏–π `IParserFactory`, —è–∫–∏–π –ø–æ–≤–µ—Ä—Ç–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏.
"""

from __future__ import annotations

# üî† –°–∏—Å—Ç–µ–º–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏
import logging	# üßæ –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø—ñ–¥ —á–∞—Å —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤
from typing import Any, Dict, List, Optional, Protocol, TYPE_CHECKING, Union, runtime_checkable	# üß∞ –ü—Ä–æ—Ç–æ–∫–æ–ª–∏ —Ç–∞ —Ç–∏–ø–∏

# üß© –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –º–æ–¥—É–ª—ñ –ø—Ä–æ—î–∫—Ç—É
from app.shared.utils.logger import LOG_NAME	# üè∑Ô∏è –ë–∞–∑–æ–≤–µ —ñ–º º—è –ª–æ–≥–µ—Ä–∞

# ================================
# üßæ –õ–û–ì–ï–† –¢–ê TYPE CHECKING
# ================================
logger = logging.getLogger(f"{LOG_NAME}.parsers.contracts")	# üßæ –ú–æ–¥—É–ª—å–Ω–∏–π –ª–æ–≥–µ—Ä
logger.debug("üßæ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –º–æ–¥—É–ª—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤ –ø–∞—Ä—Å–µ—Ä—ñ–≤.")	# ü™µ –§—ñ–∫—Å—É—î–º–æ —ñ–º–ø–æ—Ä—Ç

# –í–ê–ñ–õ–ò–í–û: —É–Ω–∏–∫–∞—Ç–∏ —Ä–∞–Ω—Ç–∞–π–º-—ñ–º–ø–æ—Ä—Ç—ñ–≤ –¥–æ–º–µ–Ω—É ‚Äî –ª–∏—à–µ –ø—ñ–¥ TYPE_CHECKING,
# –∞–±–∏ –Ω–µ —Ç—è–≥–Ω—É—Ç–∏ –∑–∞–π–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ç–∞ –æ–º–∏–Ω—É—Ç–∏ —Ü–∏–∫–ª–∏.
if TYPE_CHECKING:
    from app.domain.products.dto import ProductHeaderDTO	# üßæ DTO –∑–∞–≥–æ–ª–æ–≤–∫–∞
    from app.domain.products.entities import ProductInfo, Url	# üì¶ –î–æ–º–µ–Ω–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ
    from app.domain.products.interfaces import (	# ü§ù –î–æ–º–µ–Ω–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏
        ICollectionLinksProvider,
        IProductDataProvider,
        IProductSearchProvider,
    )

__all__ = [
    "ICollectionParser",	# üîó –ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø–∞—Ä—Å–µ—Ä–∞ –∫–æ–ª–µ–∫—Ü—ñ–π
    "IProductParser",	# üõí –ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø–∞—Ä—Å–µ—Ä–∞ —Ç–æ–≤–∞—Ä—É
    "ISearchParser",	# üîç –ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ—à—É–∫–æ–≤–æ–≥–æ —Ä–µ–∑–æ–ª—å–≤–µ—Ä–∞
    "IParserFactory",	# üè≠ –î–æ–º–µ–Ω–Ω–∞ —Ñ–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤
]


# ================================
# üîó –Ü–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ù–Ü –ü–ê–†–°–ï–†–ò (–ü–†–û–¢–û–ö–û–õ–ò)
# ================================
@runtime_checkable
class ICollectionParser(Protocol):
    """üîó –†–µ–∞–ª—å–Ω–∏–π –ø–∞—Ä—Å–µ—Ä –∫–æ–ª–µ–∫—Ü—ñ–π: –ø–æ–≤–µ—Ä—Ç–∞—î —Å–∏—Ä—ñ product-URL —è–∫ —Ä—è–¥–∫–∏."""

    async def get_product_links(self) -> List[str]:
        """üîó –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ —Ä—è–¥–∫–æ–≤–∏—Ö URL; –ø–æ—Ä–æ–∂–Ω—ñ–π —Å–ø–∏—Å–æ–∫ = –Ω–µ–º–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤."""
        ...


@runtime_checkable
class IProductParser(Protocol):
    """üõí –ü–∞—Ä—Å–µ—Ä –æ–¥–∏–Ω–∏—á–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É: –ø–æ–≤–Ω—ñ –¥–∞–Ω—ñ + (–æ–ø—Ü—ñ–π–Ω–æ) –∑–∞–≥–æ–ª–æ–≤–æ–∫."""

    async def get_product_info(self) -> "ProductInfo":
        """üõí –û—Å–Ω–æ–≤–Ω–∏–π –º–µ—Ç–æ–¥: –ø–æ–≤–µ—Ä—Ç–∞—î –≤–∞–ª—ñ–¥–Ω–∏–π `ProductInfo` –Ω–∞–≤—ñ—Ç—å –∑–∞ –∑–±–æ—ó–≤."""
        ...

    async def get_header_info(self) -> Union["ProductHeaderDTO", Dict[str, Any], None]:
        """üè∑Ô∏è –û–ø—Ü—ñ–π–Ω–æ: —à–≤–∏–¥–∫–∏–π –ø—Ä–µ–≤ º—é (title/image). –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å ‚Üí fallback —á–µ—Ä–µ–∑ info."""
        ...


@runtime_checkable
class ISearchParser(Protocol):
    """üîç –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏–π –ø–æ—à—É–∫: –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –ø–µ—Ä—à–∏–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏–π —Ç–æ–≤–∞—Ä–Ω–∏–π URL."""

    async def resolve(self, query: str) -> Optional[str]:
        """üîç –ü–æ–≤–µ—Ä—Ç–∞—î product-URL –∞–±–æ `None`, —è–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ/–∫–∞–ø—á–∞/—Ç–∞–π–º–∞—É—Ç."""
        ...


# ================================
# üè≠ –î–û–ú–ï–ù–ù–û-–ß–ò–°–¢–ê –§–ê–ë–†–ò–ö–ê
# ================================
@runtime_checkable
class IParserFactory(Protocol):
    """üè≠ –§–∞–±—Ä–∏–∫–∞, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î –¥–æ–º–µ–Ω–Ω—ñ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏ –±–µ–∑ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π."""

    def create_collection_provider(self, url: "Url") -> "ICollectionLinksProvider":
        """üìö –°—Ç–≤–æ—Ä—é—î –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∫–æ–ª–µ–∫—Ü—ñ–π –¥–ª—è –¥–æ–º–µ–Ω–Ω–æ–≥–æ `Url`."""
        ...

    def create_product_provider(self, url: "Url") -> "IProductDataProvider":
        """üõí –ü–æ–≤–µ—Ä—Ç–∞—î –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–∞–Ω–∏—Ö –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É."""
        ...

    def create_search_provider(self) -> "IProductSearchProvider":
        """üîç (–û–ø—Ü—ñ–π–Ω–æ) –ü–æ–≤–µ—Ä—Ç–∞—î –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ—à—É–∫—É; –º–æ–∂–µ –∫–∏–Ω—É—Ç–∏ `NotImplementedError`."""
        ...
