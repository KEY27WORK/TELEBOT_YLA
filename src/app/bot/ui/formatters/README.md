# üñãÔ∏è Formatters (Telegram UI formatting layer)

–ü–∞–∫–µ—Ç **`app/bot/ui/formatters`** –º—ñ—Å—Ç–∏—Ç—å —Ç–æ–Ω–∫–∏–π —à–∞—Ä —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è UI:
–ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î DTO/—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–æ–º–µ–Ω—É –Ω–∞ –≥–æ—Ç–æ–≤–∏–π **HTML‚Äë—Ç–µ–∫—Å—Ç** –¥–ª—è Telegram (`parse_mode="HTML"`).
–ñ–æ–¥–Ω–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ ‚Äî –ª–∏—à–µ –±–µ–∑–ø–µ—á–Ω–µ —Å–∫–ª–∞–¥–∞–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ —Ç–∞ —Ä–æ–∑–º—ñ—Ç–∫–∏.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```bash
formatters/
‚îú‚îÄ‚îÄ üìò README.md
‚îú‚îÄ‚îÄ üìÑ __init__.py
‚îú‚îÄ‚îÄ üìÑ message_formatter.py
‚îî‚îÄ‚îÄ üìÑ price_report_formatter.py
```

- **`message_formatter.py`** ‚Äî —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –æ–ø–∏—Å—É —Ç–æ–≤–∞—Ä—É (–∑–∞–≥–æ–ª–æ–≤–æ–∫, –±–ª–æ–∫–∏ ¬´–ú–∞—Ç–µ—Ä—ñ–∞–ª/–ü–æ—Å–∞–¥–∫–∞/–û–ø–∏—Å/–ú–æ–¥–µ–ª—å¬ª,
  –ø–µ—Ä–µ–ª—ñ–∫ –∫–æ–ª—å–æ—Ä—ñ–≤/–Ω–∞—è–≤–Ω–æ—Å—Ç—ñ, –±–µ–π–¥–∂ ¬´SOLD OUT¬ª, `format_health`). –ï–∫—Ä–∞–Ω—É—î HTML, –∫–æ–Ω—Ç—Ä–æ–ª—é—î –¥–æ–≤–∂–∏–Ω–∏.
- **`price_report_formatter.py`** ‚Äî –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–∏–π —Ü—ñ–Ω–æ–≤–∏–π –∑–≤—ñ—Ç —ñ–∑ –±–ª–æ–∫—ñ–≤ ¬´—à–∞–ø–∫–∞ ‚Üí —Ü—ñ–Ω–∞ ‚Üí –¥–æ—Å—Ç–∞–≤–∫–∞ ‚Üí —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å ‚Üí –Ω–∞—Ü—ñ–Ω–∫–∞ ‚Üí –ø—Ä–∏–±—É—Ç–æ–∫¬ª
  –∑ –º‚Äô—è–∫–∏–º–∏ —Ñ–æ–ª–±–µ–∫–∞–º–∏ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó.
- **`__init__.py`** ‚Äî –ø—É–±–ª—ñ—á–Ω–∏–π API (`MessageFormatter`, `PriceReportFormatter`).

---

## üß≠ –ü–æ—Ç–æ–∫–∏

- **Description flow:**
  `ProductContentDTO` ‚Üí `MessageFormatter.format_description(dto)` ‚Üí HTML‚Äë—Ä—è–¥–æ–∫ ‚Üí `reply_text(..., parse_mode=HTML)`.

- **Price report flow:**
  `ProductInfo` + `FullPriceDetails` + `PricingContext` + `ICurrencyConverter`
  ‚Üí `PriceReportFormatter.format_message(info, details, context, converter)`
  ‚Üí HTML‚Äë—Ä—è–¥–æ–∫ ‚Üí `reply_text(..., parse_mode=HTML)`.

---

## üõ°Ô∏è –ü—Ä–∏–Ω—Ü–∏–ø–∏

- **SRP:** –∫–æ–∂–µ–Ω —Ñ–∞–π–ª –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ —Å–≤—ñ–π —Ç–∏–ø —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è (–∂–æ–¥–Ω–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏).
- **–ë–µ–∑–ø–µ—á–Ω–∏–π HTML:** —É—Å—ñ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É—é—Ç—å—Å—è (`html.escape` / `escape`),
  –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –ª–∏—à–µ –ø—Ä–æ—Å—Ç—ñ –≤–∞–ª—ñ–¥–Ω—ñ —Ç–µ–≥–∏ (`<b>`, `<u>`, `<a href>`). –í–∏–≤—ñ–¥ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∏–π –Ω–∞ `parse_mode="HTML"`.
- **DI:** —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∏ –ø—Ä–∏–π–º–∞—é—Ç—å –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ñ –¥–∞–Ω—ñ (DTO/—Å—É—Ç–Ω–æ—Å—Ç—ñ) —ñ, –∑–∞ –ø–æ—Ç—Ä–µ–±–∏, –∑–æ–≤–Ω—ñ—à–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
  (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç) —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏.
- **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å:** –ø–æ–º–∏–ª–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –≤–∞–ª—é—Ç –Ω–µ –∑—Ä–∏–≤–∞—é—Ç—å –∑–≤—ñ—Ç ‚Äî –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–∑–Ω–∞—á–∞—é—Ç—å—Å—è —è–∫ `N/A`,
  –∞ –¥–µ—Ç–∞–ª—ñ –ø–∏—à—É—Ç—å—Å—è –≤ –ª–æ–≥ (warning). –î–ª—è –∫–∞—Ä—Ç –≤–∞–ª—é—Ç/–ø–æ—Ä—è–¥–∫—ñ–≤ —î –¥–µ—Ñ–æ–ª—Ç–Ω—ñ —Ñ–æ–ª–±–µ–∫–∏.
- **–ë–µ–∑ ¬´–º–∞–≥—ñ—ó¬ª:** –ª–µ–π–±–ª–∏ —Ç–∞ –µ–º–æ–¥–∑—ñ ‚Äî –ª–æ–∫–∞–ª—å–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞ –∞–±–æ –±–µ—Ä—É—Ç—å—Å—è –∑ `CONST`.
  –°—Ç–∞—Ç–∏—á–Ω—ñ —Ç–µ–∫—Å—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `app/bot/ui/static_messages.py`.

---

## ‚ûï –Ø–∫ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª —É `app/bot/ui/formatters/`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `availability_report_formatter.py`.
2. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–ª–∞—Å, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `AvailabilityReportFormatter` –∑ –ø—É–±–ª—ñ—á–Ω–∏–º –º–µ—Ç–æ–¥–æ–º
   `format_message(dto_or_view_model, *deps) -> str`.
3. –í–∏–Ω–µ—Å—Ç–∏ –ø—ñ–¥–ø–∏—Å–∏/–ª–µ–π–±–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –∞–±–æ –≤ `AppConstants`, —â–æ–± –Ω–µ –º–Ω–æ–∂–∏—Ç–∏ ¬´–º–∞–≥—ñ—á–Ω—ñ —Ä—è–¥–∫–∏¬ª.
4. –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∫–ª–∞—Å —É `formatters/__init__.py`.
5. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä —É —à–∞—Ä—ñ messenger/handler —ñ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ —è–∫ `reply_text(..., parse_mode=HTML)`.

---

## ‚ö†Ô∏è –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- –§–æ—Ä–º–∞—Ç—Ç–µ—Ä–∏ **–Ω–µ** —Ö–æ–¥—è—Ç—å —É –º–µ—Ä–µ–∂—É —á–∏ –±–∞–∑—É —ñ –Ω–µ –≤–∏–∫–æ–Ω—É—é—Ç—å —Ç—Ä–∏–≤–∞–ª—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó.
- –ë—É–¥—å-—è–∫—ñ –≤–∏–Ω—è—Ç–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∞–ª—é—Ç) –ª–æ–≤–ª—è—Ç—å—Å—è –π –ª–æ–≥—É—é—Ç—å—Å—è —è–∫ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è;
  –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –±–µ–∑–ø–µ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è (`N/A`).
- –¢–∞–π–º–∞—É—Ç–∏ –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è: —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è ‚Äî —à–≤–∏–¥–∫–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è O(–¥–æ–≤–∂–∏–Ω–∞ —Ç–µ–∫—Å—Ç—É).

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø–æ–∫—Ä–∏–≤–∞—Ç–∏ —é–Ω—ñ—Ç-—Ç–µ—Å—Ç–∞–º–∏ –±–µ–∑ Telegram SDK:
- –µ–∫—Ä–∞–Ω—É–≤–∞–Ω–Ω—è HTML-—Å–∏–º–≤–æ–ª—ñ–≤ —ñ –∫–æ—Ä–µ–∫—Ç–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è —Ç–µ–≥—ñ–≤;
- –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ —ñ —Ñ–æ—Ä–º–∞—Ç –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å;
- —Ñ–æ–ª–±–µ–∫–∏ `N/A` –ø—Ä–∏ –∑–±–æ—è—Ö –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞ (–º–æ–∫–∏/—Å—Ç–∞–±–∏);
- –∞–ª–≥–æ—Ä–∏—Ç–º ¬´SOLD OUT¬ª: `is_fully_sold_out()` –Ω–∞ –Ω–∞–±–æ—Ä—ñ —Ä—è–¥–∫—ñ–≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ;
- —Å–Ω–∞–ø—à–æ—Ç-—Ç–µ—Å—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ HTML –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä–æ–∑–º—ñ—Ç–∫–∏.

---

## üîå –ó–æ–≤–Ω—ñ—à–Ω—ñ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏

- `ProductContentDTO` ‚Äî –¥–∞–Ω—ñ —Ç–æ–≤–∞—Ä—É –¥–ª—è –æ–ø–∏—Å—É.
- `ProductInfo`, `FullPriceDetails`, `PricingContext` ‚Äî —Å—É—Ç–Ω–æ—Å—Ç—ñ –¥–ª—è —Ü—ñ–Ω–æ–≤–æ–≥–æ –∑–≤—ñ—Ç—É.
- `ICurrencyConverter` ‚Äî —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞ –≤–∞–ª—é—Ç (`convert(value, src, dst) -> float`).
- `AppConstants` / `CONST` ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ UI —Ç–∞ (–æ–ø—Ü—ñ–π–Ω–æ) –∫–∞—Ä—Ç–∏ –≤–∞–ª—é—Ç/–ø–æ—Ä—è–¥–∫—ñ–≤:
  `CURRENCY_SYMBOLS`, `PRICE_ORDER`, `CURRENCY_DISPLAY` (–∑–∞ —ó—Ö –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–µ—Ñ–æ–ª—Ç–∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞).

---

## üß© –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```python
# –û–ø–∏—Å —Ç–æ–≤–∞—Ä—É
from app.bot.ui.formatters import MessageFormatter
html_text = MessageFormatter.format_description(product_content_dto)
await update.message.reply_text(html_text, parse_mode=CONST.UI.DEFAULT_PARSE_MODE)
```

```python
# –¶—ñ–Ω–æ–≤–∏–π –∑–≤—ñ—Ç
from app.bot.ui.formatters import PriceReportFormatter
formatter = PriceReportFormatter()
html_report = formatter.format_message(info, details, context, converter)
await update.message.reply_text(html_report, parse_mode=CONST.UI.DEFAULT_PARSE_MODE)
```
