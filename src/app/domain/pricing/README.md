 –í–æ—Ç –≥–æ—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã ‚Äî –≤—Å—Ç–∞–≤–ª—è–π –∫–∞–∫ –µ—Å—Ç—å.

# üí∏ Domain: Pricing

–ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ —Ü–µ–Ω—ã.  
–ó–¥–µ—Å—å –Ω–µ—Ç I/O, HTTP, –ª–æ–≥–æ–≤ –∏–ª–∏ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ ‚Äî —Ç–æ–ª—å–∫–æ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –Ω–∞ –±–∞–∑–µ **`Decimal`** –∏ —Å—Ç—Ä–æ–≥–∏—Ö DTO.

---

## ‚öúÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø—ã

- **–ß–∏—Å—Ç–æ—Ç–∞ –∏ –∏–∑–æ–ª—è—Ü–∏—è** ‚Äî –º–æ–¥—É–ª—å –Ω–µ–∑–∞–≤–∏—Å–∏–º –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
- **–¢–æ—á–Ω–æ—Å—Ç—å** ‚Äî –≤—Å–µ –¥–µ–Ω—å–≥–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `Decimal` (–Ω–∏–∫–∞–∫–∏—Ö `float`).
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã/–ø–æ—Ä–æ–≥–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞–º–∏, –±–µ–∑ ¬´–º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª¬ª.
- **–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã** ‚Äî –¥–≤–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:
  - `IPriceService.build_quote(PriceInput) -> PriceBreakdown` ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –ø–æ—Ç–æ–∫.
  - `IPricingService.calculate_full_price(...) -> FullPriceDetails` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç—á—ë—Ç (legacy‚Äë—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å).
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è unit‚Äë—Ç–µ—Å—Ç–∞–º–∏; –≤–∞–ª—é—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –ø–æ–¥–º–µ–Ω—è—é—Ç—Å—è —Ñ–µ–π–∫–æ–≤—ã–º `IMoneyConverter`.

---

## üìÇ –°–æ—Å—Ç–∞–≤ –ø–∞–∫–µ—Ç–∞

```bash
app/domain/pricing/
‚îú‚îÄ README.md           # —ç—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ __init__.py        # —ç–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ API
‚îú‚îÄ interfaces.py       # Money / DTO / –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã IPriceService –∏ IPricingService
‚îú‚îÄ rounding.py         # –æ–±—â–µ–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ Decimal (q2/percent)
‚îî‚îÄ services.py         # —á–∏—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è PriceService + PricingRules
```
---

## üß± –ü—É–±–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

- **Money** ‚Äî `amount: Decimal`, `currency: str`.
- **PriceInput** ‚Üí **PriceBreakdown** ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π ¬´—Å–æ–±—Ä–∞—Ç—å –∫–≤–æ—Ç—É¬ª.
- **PricingContext + Money** ‚Üí **FullPriceDetails** ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Å –¥–µ—Ç–∞–ª—è–º–∏ (markup, –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ UAH –∏ —Ç.–ø.).
- **IPriceService** ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (`build_quote`).
- **IPricingService** ‚Äî —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º (`calculate_full_price`).
- **PricingRules** ‚Äî –ø—Ä–∞–≤–∏–ª–∞ (—Å—Ç–∞–≤–∫–∏/–ø–æ—Ä–æ–≥–∏/–ø—Ä–æ—Ü–µ–Ω—Ç—ã) –±–µ–∑ ¬´–º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª¬ª.
- **q2 / percent** ‚Äî —É—Ç–∏–ª–∏—Ç—ã –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–≤–æ–¥–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç.

---

## üîå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–º–µ–Ω–∞

- –í–∞–ª—é—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç **`IMoneyConverter`** (–∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–æ–º–µ–Ω–∞ `currency`), –∫–æ—Ç–æ—Ä—ã–π:
  - –ª–∏–±–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `convert(Money, to: str) -> Money`,
  - –ª–∏–±–æ `convert(amount, from: str, to: str) -> amount`.  
  `PriceService` –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –≤—Å—ë –∫ `Decimal`.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–∏–º–µ—Ä (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫)

```python
from decimal import Decimal
from app.domain.pricing import (
    Money, PriceInput, IPriceService, PriceService, PricingRules
)

# –§–µ–π–∫–æ–≤—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
class FakeConverter:
    rates = {("USD","UAH"): Decimal("40"), ("UAH","USD"): Decimal("0.025"), ("USD","USD"): Decimal("1")}
    def convert(self, x, *args):
        # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ Money, –∏ —Å–∫–∞–ª—è—Ä–æ–≤
        if hasattr(x, "amount"):
            rate = self.rates[(x.currency, args[0])]
            return Money(x.amount * rate, args[0])
        amount, from_ccy, to_ccy = x, args[0], args[1]
        rate = self.rates[(from_ccy, to_ccy)]
        return amount * rate

rules = PricingRules.from_strings(
    shipping_base_uah="150",
    shipping_per_kg_uah="120",
    commission_percent="3.5",
    discount_percent="0",
    free_threshold_uah="3000",
)

svc: IPriceService = PriceService(FakeConverter(), rules)

quote = svc.build_quote(PriceInput(
    base_price=Money(Decimal("100"), "USD"),
    weight_kg=Decimal("0.7"),
    supplier_region="us",
    target_currency="UAH",
))

print("–ò—Ç–æ–≥:", quote.total.amount, quote.total.currency)
# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞: –ò—Ç–æ–≥: 4728.00 UAH  (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–∞–≤–∏–ª –∏ –∫—É—Ä—Å–æ–≤)
```

‚∏ª

## üßæ –ü—Ä–∏–º–µ—Ä (legacy‚Äë—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

–ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç—á—ë—Ç —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ UAH ‚Äî —Ä–∞–±–æ—Ç–∞–π—Ç–µ —á–µ—Ä–µ–∑ IPricingService.calculate_full_price(...) -> FullPriceDetails.
–†–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –∞ –¥–æ–º–µ–Ω–Ω—ã–µ DTO –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å –∏–∑ —ç—Ç–æ–≥–æ –ø–∞–∫–µ—Ç–∞.

‚∏ª

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
	‚Ä¢	–ü–æ–¥–º–µ–Ω—è–π—Ç–µ IMoneyConverter —Ñ–µ–π–∫–æ–º —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏.
	‚Ä¢	–ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ PricingRules —è–≤–Ω–æ (–∫–æ–Ω—Ñ–∏–≥–∏ –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –¥–æ–º–µ–Ω–∞).
	‚Ä¢	–°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ Decimal —á–µ—Ä–µ–∑ quantize/q2, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—ã –≤ —Ç–æ—á–Ω–æ—Å—Ç–∏.

‚∏ª

## üß∞ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

–õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å:
	‚Ä¢	–ù–∞–ª–æ–≥–∏/VAT, –∫—É–ø–æ–Ω—ã, –º–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç—ã–µ —Å–∫–∏–¥–∫–∏.
	‚Ä¢	–ü–æ—Ä–æ–≥ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ —Ü–µ–ª–µ–≤–æ–π –≤–∞–ª—é—Ç–µ.
	‚Ä¢	–î—Ä—É–≥–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è (–¥–æ 10/50/100 –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –≤–∞–ª—é—Ç–µ).

‚∏ª

## üìú –ü—É–±–ª–∏—á–Ω—ã–π API (–∏–∑ __init__.py)

from .interfaces import (
    Money, PriceInput, PriceBreakdown, IPriceService,
    PricingContext, FullPriceDetails, IPricingService,
)
from .rounding import q2, percent
from .services import PriceService, PricingRules

–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏–∑ –ª—é–±–æ–≥–æ —Å–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
