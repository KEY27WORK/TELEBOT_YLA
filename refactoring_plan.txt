
# План рефакторинга и изменения проекта

## Введение
Данный документ предназначен для подробного планирования рефакторинга кода для улучшения производительности, качества и поддерживаемости при сохранении функционала.

## Общие задачи рефакторинга
Цели данных изменений включают улучшение модульности кода, освоение лучших практик Python, а также оптимизацию производительности наших систем.

## 1. Обоснование изменений

### 1.1 Проблемы текущего кода
- **Дублирование функционала:** В некоторых местах есть двойная логика обобщения данных.
- **Незавершённые методы:** Некоторые методы в `RegionalAvailabilityChecker` не завершены, что снижает функциональность.
- **Неоптимизированные асинхронные вызовы:** Некоторые ассинхронные задачи блокируют друг друга.

### 1.2 Цели улучшений
- **Модульность:** Разделение кода на более мелкие, взаимодействующие модули.
- **Поддерживаемость:** Более простой код, который легко читать и понимать другим разработчикам.
- **Оптимизация:** Эффективное использование ресурсов, своевременное кеширование, и улучшения в архитектуре.

## 2. Шаги изменения

### 2.1 Уточнение структуры проекта
- Переструктуризировать основную часть проекта, создав папку `product_availability`.
- Переместить связанные с обработкой доступности файлы в новую папку.

### 2.2 Организация основного функционала

#### AvailabilityHandler
- **Описание действия:** Работает как главный обработчик данных о доступности товаров.
  
```python
# Пример модульного кода

class AvailabilityHandler:
    def __init__(self, manager: AvailabilityManager, formatter: ColorSizeFormatter):
        self.manager = manager
        self.formatter = formatter
    
    async def handle_availability(self, product_url: str):
        product_path = extract_product_path(product_url)

        # Получение информации о доступности
        availability_data = await self.manager.check_availability(product_path)

        # Форматирование данных
        formatted_output = self.formatter.format(availability_data)

        return formatted_output
```

##### Улучшения:
- Используйте DI (Dependency Injection) для гибкости и тестируемости.
- Применяйте `asyncio.gather()` для улучшения параллельных задач.

### 2.3 Детализирование структур регионального парсинга

#### RegionalAvailabilityChecker
- **Завершение методов:**
- Реализация логики проверки с использованием существующих методов в `JsonLdAvailabilityParser`.
```python
async def check_full(self, product_path: str) -> dict:
    full_availability = await JsonLdAvailabilityParser.parse(product_path)
    return full_availability
```

### 2.4 Уточнение и улучшение базовых классов

#### BaseParser
- **Очистка и упрощение:** Убедитесь, что базовый класс только выполняет необходимые действия, делегируя специализированные задачи другим классам.
```python
class BaseParser:
    ...
    async def parse_details(self):
        # Простая логика разделения типов парсинга
        functions = [self.extract_title, self.extract_price, self.extract_image]
        results = await asyncio.gather(*functions)
        return dict(zip(['title', 'price', 'image'], results))
```

### 2.5 Исправление форматов

#### ColorSizeFormatter
- **Ревизия логики форматирования:** Используйте ф-строки.
```python
def format_data(data: dict) -> str:
    return "
".join(f"{color}: {', '.join(sizes)}" for color, sizes in data.items())
```

## 3. Реализация изменений
Следуйте предложенным шагам, фиксируя каждое изменение в версии контроля.

## 4. Тестирование и верификация
Подготовьте тесты и методы принятия изменений. Создайте среду, где изменения могут быть проверены без влияния на продакшен.

# Заключение
Завершение этих шагов повысит качество проекта, минимизируя ошибки при увеличении производительности и поддерживаемости. Пожалуйста, следуйте изложенным пунктам, чтобы достичь поставленных целей.

