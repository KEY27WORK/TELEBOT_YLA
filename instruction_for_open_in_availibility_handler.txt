# üì¶ –ó–ê–î–ê–ß–ê

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º—É–ª—å—Ç–∏-—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ TELEBOTYLAUKRAINE.
–ù—É–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ: Availability Aggregator.

# üìå –ö–ê–ö–ò–ï –§–ê–ô–õ–´ –ó–ê–î–ï–ô–°–¢–í–û–í–ê–¢–¨

1Ô∏è‚É£ bot/keyboards.py ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É
2Ô∏è‚É£ bot/menu_handler.py ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—Ç–∫—É —Ä–µ–∂–∏–º–∞
3Ô∏è‚É£ core/parsing/availability_aggregator.py ‚Äî —Å–æ–∑–¥–∞—Ç—å
4Ô∏è‚É£ core/parsing/json_ld_parser.py ‚Äî —Å–æ–∑–¥–∞—Ç—å
5Ô∏è‚É£ core/parsing/availability_checker.py ‚Äî —Å–æ–∑–¥–∞—Ç—å
6Ô∏è‚É£ core/parsing/color_size_formatter.py2 ‚Äî —Å–æ–∑–¥–∞—Ç—å
7Ô∏è‚É£ core/parsing/base_parser.py ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π
8Ô∏è‚É£ core/webdriver/webdriver_service.py ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π
9Ô∏è‚É£ bot/handlers/product_collection_handler.py ‚Äî –ø–æ–∫–∞ –Ω–µ —Ç—Ä–æ–≥–∞–µ–º
10Ô∏è‚É£ errors/error_handler.py ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –¥–ª—è –æ—à–∏–±–æ–∫

# üìå –ö–ê–ö –ë–£–î–ï–¢ –†–ê–ë–û–¢–ê–¢–¨

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "üåç –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä–∏ –≤ —Ä–µ–≥—ñ–æ–Ω–∞—Ö"
- –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ä–µ–∂–∏–º region_availability
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä
- –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç AvailabilityAggregator –¥–ª—è —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –≤—Å–µ–º —Ä–µ–≥–∏–æ–Ω–∞–º: US, EU, UK, UA
- –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö:
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —á–µ—Ä–µ–∑ BaseParser
  - –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –æ —Ä–∞–∑–º–µ—Ä–∞—Ö –∏ —Ü–≤–µ—Ç–∞—Ö —á–µ—Ä–µ–∑ JsonLdAvailabilityParser
  - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≥–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –∏ –∫—Ä–∞—Å–∏–≤–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram:
  - –ü—É–±–ª–∏—á–Ω—ã–π –≤—ã–≤–æ–¥
  - –í—ã–≤–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∞

# üìå –ü–û–î–†–û–ë–ù–´–ï –ó–ê–î–ê–ß–ò –ü–û –§–ê–ô–õ–ê–ú

--- bot/keyboards.py ---

–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É:

["üåç –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä–∏ –≤ —Ä–µ–≥—ñ–æ–Ω–∞—Ö"]

--- bot/menu_handler.py ---

–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏–º region_availability:

elif text == "üåç –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä–∏ –≤ —Ä–µ–≥—ñ–æ–Ω–∞—Ö":
    user_data["mode"] = "region_availability"
    await update.message.reply_text("üåç –†–µ–∂–∏–º –º—É–ª—å—Ç–∏-—Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ.\n–ù–∞–¥—ñ—à–ª—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–æ–≤–∞—Ä.")

--- core/parsing/availability_aggregator.py ---

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å AvailabilityAggregator:

- –ú–µ—Ç–æ–¥ aggregate_availability(product_path: str) ‚Üí —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—Å–µ–º —Ä–µ–≥–∏–æ–Ω–∞–º
- –ú–µ—Ç–æ–¥ merge_global_stock() ‚Üí –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ —Ä–µ–≥–∏–æ–Ω—ã
- –ú–µ—Ç–æ–¥ aggregate_availability_formatted() ‚Üí –æ—Ç–¥–∞—ë—Ç –∫—Ä–∞—Å–∏–≤–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É

--- core/parsing/json_ld_parser.py ---

–°–æ–∑–¥–∞—Ç—å JsonLdAvailabilityParser:

- –ü–∞—Ä—Å–∏—Ç JSON-LD –¥–∞–Ω–Ω—ã–µ –∏–∑ page_source
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞, —Ä–∞–∑–º–µ—Ä—ã, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
- –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ json.loads() –ø–æ —Ç–µ–≥—É <script type="application/ld+json">

--- core/parsing/availability_checker.py ---

–°–æ–∑–¥–∞—Ç—å AvailabilityChecker:

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –≤—Å–µ–º —Ä–µ–≥–∏–æ–Ω–∞–º (–¥–∞/–Ω–µ—Ç)
- –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö BaseParser, –±–µ–∑ –≤—ã—Ç—è–≥–∏–≤–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤

--- core/parsing/color_size_formatter.py ---

–°–æ–∑–¥–∞—Ç—å ColorSizeFormatter:

- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Ä–∞–∑–º–µ—Ä–æ–≤/–Ω–∞–ª–∏—á–∏—è –≤ –∫—Ä–∞—Å–∏–≤—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è Telegram
- –ú–µ—Ç–æ–¥—ã:
    - format_color_size_availability()
    - format_for_admin()

--- core/parsing/base_parser.py ---

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π BaseParser:
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ WebDriver
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç page_source

--- core/webdriver/webdriver_service.py ---

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –µ—Å—Ç—å ‚Äî –¥–ª—è Selenium WebDriver.

--- bot/link_handler.py ---

–í –Ω–æ–≤–æ–π –≤–µ—Ç–∫–µ region_availability –ø–æ–¥–∫–ª—é—á–∏—Ç—å:

- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å AvailabilityAggregator –∏ AvailabilityChecker
- –í—ã–∑—ã–≤–∞—Ç—å aggregate_availability_formatted() –∏ check()

–ü—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

if mode == "region_availability":
    if is_product:
        await update.message.reply_text("üåç –í–∏–∫–æ–Ω—É—é –º—É–ª—å—Ç–∏-—Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É...")

        from core.parsing.availability_aggregator import AvailabilityAggregator
        from core.parsing.availability_checker import AvailabilityChecker

        product_path = extract_product_path(text)
        regions_status = await AvailabilityChecker.check(product_path)
        formatted_result = await AvailabilityAggregator.aggregate_availability_formatted(product_path)

        await update.message.reply_text(f"üì¶ <b>–°—Ç–∞—Ç—É—Å –ø–æ —Ä–µ–≥—ñ–æ–Ω–∞—Ö:</b>\n{regions_status}", parse_mode="HTML")
        await update.message.reply_text(f"üëï <b>–î–æ—Å—Ç—É–ø–Ω—ñ —Ä–æ–∑–º—ñ—Ä–∏:</b>\n{formatted_result}", parse_mode="HTML")
    else:
        await update.message.reply_text("‚ùå –¶–µ –Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–æ–≤–∞—Ä.")

# üìå –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û

- –í—Å–µ –º–µ—Ç–æ–¥—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ.
- –ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å asyncio.gather() –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.
- –°—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å—Ç—Ä–æ–≥–æ –ø–æ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ TELEBOTYLAUKRAINE.
- –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å—Ç–∏–ª—é SOLID, –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.
